<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=ja class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>FireDucks内部で働く高速化技術 | FireDucks</title>
<meta name=description content="groupbyの切り替え この記事ではFireDucks内部で使われているgroupby高速化技術について紹介します．
表データ分析においてgroupby操作は最も基本的で重要な操作の一つです． groupby操作を用いることでデータの平均や分散といった重要な統計的性質を知ることができ， その他操作と組み合わせることで新しい特徴量を得ることもできます．
FireDucksでは高速なgroupby操作を実現するためにデータ特性に応じた最適化を行っています． その一つがグループ数によるgroupbyアルゴリズムの自動選択です． 具体的にはデータのグループ数に注目しグループ数が小さいデータに対して高速に計算可能な アルゴリズム(アルゴリズムAと呼ぶ)と， グループ数が大きいデータに対して高速に計算可能なアルゴリズム(アルゴリズムBと呼ぶ)とを切り替えています． ここでグループ数とは注目するカラムを構成するデータの種類を示します．
例えば以下のような表データを考えてみましょう．
food category 0 apple fruit 1 carrot vegetable 2 peach fruit 3 onion vegetable 4 grape fruit foodカラムを構成する要素に注目するとapple, carrot, peach, onion, grapeの5種類であることが分かります． よってfoodカラムのグループ数は5です． 一方で，categoryカラムを構成する要素に注目するとfruit,vegetableの2種類であることが分かります． よってcategoryカラムのグループ数は2です．
グループ数の推定 巨大なデータを扱うときに実際にデータを全て確認してグループ数を計算すると時間がかかります． そこで，FireDucksではグループ数の厳密な値を求めることなく統計的手法を用いてグループ数の推定を行っています1． 具体的には以下の手順で行われます．
注目するグループキーのデータ列の中からランダムにデータを一つ取り出す． 取り出したデータを記録する． 再び注目するグループキーのデータ列の中からランダムにデータを一つ取り出す， すでに記録してあるデータと一致するか判定を行い，データを記録する． 3,4の操作を一定回数繰り返す． 3と4の操作を一定回数繰り返した後，データを取り出した回数と一致した回数から 注目するグループキーのデータのグループ数を推定する．
性能評価 データ分析に関する多くの処理を含むベンチマークであるTPC-Hを用いて計算速度の計測を行いました．
Aはgroupby操作をアルゴリズムAのみを用いており，Bはgroupby操作をアルゴリズムBのみを用いています． autoはgroupby操作についてグループ数の推定とアルゴリズムAとBの自動選択をしています． アルゴリズムAとアルゴリズムBの実行時間にほとんど差がない処理については上のグラフでは省略しています． グラフから，q10を除く処理で自動判定アルゴリズムは，アルゴリズムAとアルゴリズムBのうち速い方のアルゴリズムの選択ができていることが分かります． totalはアルゴリズムA,アルゴリズムB,自動選択アルゴリズムについて上記グラフから除いた処理も含めたTPC-H全体の計算時間を示しています． このことからTPC-H全体において，自動判定アルゴリズムはアルゴリズムAに対して3倍程度高速化ができており， アルゴリズムBに対しては1.2倍程度高速化ができていることが分かります．
参考 M. Bressan, E. Peserico, and L. Pretto. Simple set cardinality estimation through random sampling."><meta property="og:title" content="FireDucks内部で働く高速化技術"><meta property="og:description" content="groupbyの切り替え この記事ではFireDucks内部で使われているgroupby高速化技術について紹介します．
表データ分析においてgroupby操作は最も基本的で重要な操作の一つです． groupby操作を用いることでデータの平均や分散といった重要な統計的性質を知ることができ， その他操作と組み合わせることで新しい特徴量を得ることもできます．
FireDucksでは高速なgroupby操作を実現するためにデータ特性に応じた最適化を行っています． その一つがグループ数によるgroupbyアルゴリズムの自動選択です． 具体的にはデータのグループ数に注目しグループ数が小さいデータに対して高速に計算可能な アルゴリズム(アルゴリズムAと呼ぶ)と， グループ数が大きいデータに対して高速に計算可能なアルゴリズム(アルゴリズムBと呼ぶ)とを切り替えています． ここでグループ数とは注目するカラムを構成するデータの種類を示します．
例えば以下のような表データを考えてみましょう．
food category 0 apple fruit 1 carrot vegetable 2 peach fruit 3 onion vegetable 4 grape fruit foodカラムを構成する要素に注目するとapple, carrot, peach, onion, grapeの5種類であることが分かります． よってfoodカラムのグループ数は5です． 一方で，categoryカラムを構成する要素に注目するとfruit,vegetableの2種類であることが分かります． よってcategoryカラムのグループ数は2です．
グループ数の推定 巨大なデータを扱うときに実際にデータを全て確認してグループ数を計算すると時間がかかります． そこで，FireDucksではグループ数の厳密な値を求めることなく統計的手法を用いてグループ数の推定を行っています1． 具体的には以下の手順で行われます．
注目するグループキーのデータ列の中からランダムにデータを一つ取り出す． 取り出したデータを記録する． 再び注目するグループキーのデータ列の中からランダムにデータを一つ取り出す， すでに記録してあるデータと一致するか判定を行い，データを記録する． 3,4の操作を一定回数繰り返す． 3と4の操作を一定回数繰り返した後，データを取り出した回数と一致した回数から 注目するグループキーのデータのグループ数を推定する．
性能評価 データ分析に関する多くの処理を含むベンチマークであるTPC-Hを用いて計算速度の計測を行いました．
Aはgroupby操作をアルゴリズムAのみを用いており，Bはgroupby操作をアルゴリズムBのみを用いています． autoはgroupby操作についてグループ数の推定とアルゴリズムAとBの自動選択をしています． アルゴリズムAとアルゴリズムBの実行時間にほとんど差がない処理については上のグラフでは省略しています． グラフから，q10を除く処理で自動判定アルゴリズムは，アルゴリズムAとアルゴリズムBのうち速い方のアルゴリズムの選択ができていることが分かります． totalはアルゴリズムA,アルゴリズムB,自動選択アルゴリズムについて上記グラフから除いた処理も含めたTPC-H全体の計算時間を示しています． このことからTPC-H全体において，自動判定アルゴリズムはアルゴリズムAに対して3倍程度高速化ができており， アルゴリズムBに対しては1.2倍程度高速化ができていることが分かります．
参考 M. Bressan, E. Peserico, and L. Pretto. Simple set cardinality estimation through random sampling."><meta property="og:type" content="article"><meta property="og:url" content="https://fireducks-dev.github.io/ja/posts/est/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-05T00:00:00+09:00"><meta property="article:modified_time" content="2023-12-05T00:00:00+09:00"><meta itemprop=name content="FireDucks内部で働く高速化技術"><meta itemprop=description content="groupbyの切り替え この記事ではFireDucks内部で使われているgroupby高速化技術について紹介します．
表データ分析においてgroupby操作は最も基本的で重要な操作の一つです． groupby操作を用いることでデータの平均や分散といった重要な統計的性質を知ることができ， その他操作と組み合わせることで新しい特徴量を得ることもできます．
FireDucksでは高速なgroupby操作を実現するためにデータ特性に応じた最適化を行っています． その一つがグループ数によるgroupbyアルゴリズムの自動選択です． 具体的にはデータのグループ数に注目しグループ数が小さいデータに対して高速に計算可能な アルゴリズム(アルゴリズムAと呼ぶ)と， グループ数が大きいデータに対して高速に計算可能なアルゴリズム(アルゴリズムBと呼ぶ)とを切り替えています． ここでグループ数とは注目するカラムを構成するデータの種類を示します．
例えば以下のような表データを考えてみましょう．
food category 0 apple fruit 1 carrot vegetable 2 peach fruit 3 onion vegetable 4 grape fruit foodカラムを構成する要素に注目するとapple, carrot, peach, onion, grapeの5種類であることが分かります． よってfoodカラムのグループ数は5です． 一方で，categoryカラムを構成する要素に注目するとfruit,vegetableの2種類であることが分かります． よってcategoryカラムのグループ数は2です．
グループ数の推定 巨大なデータを扱うときに実際にデータを全て確認してグループ数を計算すると時間がかかります． そこで，FireDucksではグループ数の厳密な値を求めることなく統計的手法を用いてグループ数の推定を行っています1． 具体的には以下の手順で行われます．
注目するグループキーのデータ列の中からランダムにデータを一つ取り出す． 取り出したデータを記録する． 再び注目するグループキーのデータ列の中からランダムにデータを一つ取り出す， すでに記録してあるデータと一致するか判定を行い，データを記録する． 3,4の操作を一定回数繰り返す． 3と4の操作を一定回数繰り返した後，データを取り出した回数と一致した回数から 注目するグループキーのデータのグループ数を推定する．
性能評価 データ分析に関する多くの処理を含むベンチマークであるTPC-Hを用いて計算速度の計測を行いました．
Aはgroupby操作をアルゴリズムAのみを用いており，Bはgroupby操作をアルゴリズムBのみを用いています． autoはgroupby操作についてグループ数の推定とアルゴリズムAとBの自動選択をしています． アルゴリズムAとアルゴリズムBの実行時間にほとんど差がない処理については上のグラフでは省略しています． グラフから，q10を除く処理で自動判定アルゴリズムは，アルゴリズムAとアルゴリズムBのうち速い方のアルゴリズムの選択ができていることが分かります． totalはアルゴリズムA,アルゴリズムB,自動選択アルゴリズムについて上記グラフから除いた処理も含めたTPC-H全体の計算時間を示しています． このことからTPC-H全体において，自動判定アルゴリズムはアルゴリズムAに対して3倍程度高速化ができており， アルゴリズムBに対しては1.2倍程度高速化ができていることが分かります．
参考 M. Bressan, E. Peserico, and L. Pretto. Simple set cardinality estimation through random sampling."><meta itemprop=datePublished content="2023-12-05T00:00:00+09:00"><meta itemprop=dateModified content="2023-12-05T00:00:00+09:00"><meta itemprop=wordCount content="75"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="FireDucks内部で働く高速化技術"><meta name=twitter:description content="groupbyの切り替え この記事ではFireDucks内部で使われているgroupby高速化技術について紹介します．
表データ分析においてgroupby操作は最も基本的で重要な操作の一つです． groupby操作を用いることでデータの平均や分散といった重要な統計的性質を知ることができ， その他操作と組み合わせることで新しい特徴量を得ることもできます．
FireDucksでは高速なgroupby操作を実現するためにデータ特性に応じた最適化を行っています． その一つがグループ数によるgroupbyアルゴリズムの自動選択です． 具体的にはデータのグループ数に注目しグループ数が小さいデータに対して高速に計算可能な アルゴリズム(アルゴリズムAと呼ぶ)と， グループ数が大きいデータに対して高速に計算可能なアルゴリズム(アルゴリズムBと呼ぶ)とを切り替えています． ここでグループ数とは注目するカラムを構成するデータの種類を示します．
例えば以下のような表データを考えてみましょう．
food category 0 apple fruit 1 carrot vegetable 2 peach fruit 3 onion vegetable 4 grape fruit foodカラムを構成する要素に注目するとapple, carrot, peach, onion, grapeの5種類であることが分かります． よってfoodカラムのグループ数は5です． 一方で，categoryカラムを構成する要素に注目するとfruit,vegetableの2種類であることが分かります． よってcategoryカラムのグループ数は2です．
グループ数の推定 巨大なデータを扱うときに実際にデータを全て確認してグループ数を計算すると時間がかかります． そこで，FireDucksではグループ数の厳密な値を求めることなく統計的手法を用いてグループ数の推定を行っています1． 具体的には以下の手順で行われます．
注目するグループキーのデータ列の中からランダムにデータを一つ取り出す． 取り出したデータを記録する． 再び注目するグループキーのデータ列の中からランダムにデータを一つ取り出す， すでに記録してあるデータと一致するか判定を行い，データを記録する． 3,4の操作を一定回数繰り返す． 3と4の操作を一定回数繰り返した後，データを取り出した回数と一致した回数から 注目するグループキーのデータのグループ数を推定する．
性能評価 データ分析に関する多くの処理を含むベンチマークであるTPC-Hを用いて計算速度の計測を行いました．
Aはgroupby操作をアルゴリズムAのみを用いており，Bはgroupby操作をアルゴリズムBのみを用いています． autoはgroupby操作についてグループ数の推定とアルゴリズムAとBの自動選択をしています． アルゴリズムAとアルゴリズムBの実行時間にほとんど差がない処理については上のグラフでは省略しています． グラフから，q10を除く処理で自動判定アルゴリズムは，アルゴリズムAとアルゴリズムBのうち速い方のアルゴリズムの選択ができていることが分かります． totalはアルゴリズムA,アルゴリズムB,自動選択アルゴリズムについて上記グラフから除いた処理も含めたTPC-H全体の計算時間を示しています． このことからTPC-H全体において，自動判定アルゴリズムはアルゴリズムAに対して3倍程度高速化ができており， アルゴリズムBに対しては1.2倍程度高速化ができていることが分かります．
参考 M. Bressan, E. Peserico, and L. Pretto. Simple set cardinality estimation through random sampling."><link rel=preload href=/scss/main.min.2404b01c5fb65f0b4d76f0c632723d405f2faf20557f5aeff94d8efb2e91ec8b.css as=style><link href=/scss/main.min.2404b01c5fb65f0b4d76f0c632723d405f2faf20557f5aeff94d8efb2e91ec8b.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.3.min.js integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin=anonymous></script></head><body class="td-page td-blog"><header><nav class="td-navbar navbar-dark js-navbar-scroll"><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/ja/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>FireDucks</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/ja/docs/get-started><span>Get Started</span></a></li><li class=nav-item><a class=nav-link href=/ja/docs/user-guide/01-intro/><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=/ja/posts><span>Blogs</span></a></li><li class=nav-item><a class=nav-link href=/ja/docs/benchmarks><span>Benchmarks</span></a></li><li class=nav-item><a class=nav-link href=/ja/docs/about-us><span>About Us</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Japanese</a><ul class=dropdown-menu><li><a class=dropdown-item href=/posts/est/>English</a></li></ul></div></li></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><div class="td-sidebar-nav__section nav-item dropdown d-block d-lg-none"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Japanese</a><ul class=dropdown-menu><li><a class=dropdown-item href=/posts/est/>English</a></li></ul></div></div><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-japosts-li><a href=/ja/posts/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-japosts><span>Posts</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japosts2023-12-24-ishizaka-li><a href=https://qiita.com/iszk1215/items/4916799360bfafd57bc4 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-japosts2023-12-24-ishizaka><i class="fa fa-external-link"></i><span>FireDucks vs Polars 42勝24敗！ あなたはどっちを使ってpandasを高速化する！？</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japosts2023-12-20-daido-li><a href=https://qiita.com/shu_ohm1/items/33642646f5c055066cfe target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-japosts2023-12-20-daido><i class="fa fa-external-link"></i><span>FireDucks に隠し機能を作ろうと思ったけどボツになった話</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japosts2023-12-18-araki-li><a href=https://qiita.com/takuya-araki/items/38c3554ba72c9eb274ba target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-japosts2023-12-18-araki><i class="fa fa-external-link"></i><span>FireDucksにおける最適化処理の紹介</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japosts2023-12-15-ishizaka-li><a href=https://qiita.com/iszk1215/items/2c6385fa575de378a619 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-japosts2023-12-15-ishizaka><i class="fa fa-external-link"></i><span>FireDucksを支える技術</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japosts2023-12-08-ohno-li><a href=https://qiita.com/ysyk-ohno/items/ddaaeca630d741a78f14 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-japosts2023-12-08-ohno><i class="fa fa-external-link"></i><span>FireDucks の GroupBy アルゴリズム切替えについての解説</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-japostsest-li><a href=/ja/posts/est/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-japostsest><span class=td-sidebar-nav-active-item>FireDucks内部で働く高速化技術</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japosts2023-12-04-ishizaka-li><a href=https://qiita.com/iszk1215/items/abe7621d9f6754de690a target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-japosts2023-12-04-ishizaka><i class="fa fa-external-link"></i><span>FireDucksのご紹介</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japosts2023-12-01-daido-li><a href=https://qiita.com/shu_ohm1/items/b0a35cfb4fce5b71c715 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-japosts2023-12-01-daido><i class="fa fa-external-link"></i><span>FireDucks のインポートフック機能にまつわるエトセトラ</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japostsimporthook-li><a href=/ja/posts/importhook/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-japostsimporthook><span>インポートフック：ソースコードを書き換えずに FireDucks を使う方法のご紹介</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japostsnes_taxi-li><a href=/ja/posts/nes_taxi/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-japostsnes_taxi><span>Pythonの高速データフレームライブラリFireDucksを使ってみた</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japoststtdc-li><a href=https://jpn.nec.com/rd/technologies/202312/index.html target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-japoststtdc><i class="fa fa-external-link"></i><span>導入事例：トヨタテクニカルディベロップメント株式会社様 「Spicy MINT」</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#groupbyの切り替え>groupbyの切り替え</a></li><li><a href=#グループ数の推定>グループ数の推定</a></li><li><a href=#性能評価>性能評価</a></li><li><a href=#参考>参考</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><a class=td-rss-button title=RSS href=https://fireducks-dev.github.io/ja/posts/index.xml target=_blank rel=noopener><i class="fa-solid fa-rss" aria-hidden=true></i></a><div class=td-content><h1>FireDucks内部で働く高速化技術</h1><div class="td-byline mb-4"><time datetime=2023-12-05 class=text-muted>Tuesday, December 05, 2023</time></div><header class=article-meta></header><h2 id=groupbyの切り替え>groupbyの切り替え</h2><p>この記事ではFireDucks内部で使われているgroupby高速化技術について紹介します．</p><p>表データ分析においてgroupby操作は最も基本的で重要な操作の一つです．
groupby操作を用いることでデータの平均や分散といった重要な統計的性質を知ることができ，
その他操作と組み合わせることで新しい特徴量を得ることもできます．</p><p>FireDucksでは高速なgroupby操作を実現するためにデータ特性に応じた最適化を行っています．
その一つがグループ数によるgroupbyアルゴリズムの自動選択です．
具体的にはデータのグループ数に注目しグループ数が小さいデータに対して高速に計算可能な
アルゴリズム(アルゴリズムAと呼ぶ)と，
グループ数が大きいデータに対して高速に計算可能なアルゴリズム(アルゴリズムBと呼ぶ)とを切り替えています．
ここでグループ数とは注目するカラムを構成するデータの種類を示します．</p><p>例えば以下のような表データを考えてみましょう．</p><table><thead><tr><th></th><th>food</th><th>category</th></tr></thead><tbody><tr><td>0</td><td>apple</td><td>fruit</td></tr><tr><td>1</td><td>carrot</td><td>vegetable</td></tr><tr><td>2</td><td>peach</td><td>fruit</td></tr><tr><td>3</td><td>onion</td><td>vegetable</td></tr><tr><td>4</td><td>grape</td><td>fruit</td></tr></tbody></table><p>foodカラムを構成する要素に注目するとapple, carrot, peach, onion, grapeの5種類であることが分かります．
よってfoodカラムのグループ数は5です．
一方で，categoryカラムを構成する要素に注目するとfruit,vegetableの2種類であることが分かります．
よってcategoryカラムのグループ数は2です．</p><h2 id=グループ数の推定>グループ数の推定</h2><p>巨大なデータを扱うときに実際にデータを全て確認してグループ数を計算すると時間がかかります．
そこで，FireDucksではグループ数の厳密な値を求めることなく統計的手法を用いてグループ数の推定を行っています<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>．
具体的には以下の手順で行われます．</p><ol><li>注目するグループキーのデータ列の中からランダムにデータを一つ取り出す．</li><li>取り出したデータを記録する．</li><li>再び注目するグループキーのデータ列の中からランダムにデータを一つ取り出す，</li><li>すでに記録してあるデータと一致するか判定を行い，データを記録する．</li><li>3,4の操作を一定回数繰り返す．</li></ol><p>3と4の操作を一定回数繰り返した後，データを取り出した回数と一致した回数から
注目するグループキーのデータのグループ数を推定する．</p><h2 id=性能評価>性能評価</h2><p>データ分析に関する多くの処理を含むベンチマークであるTPC-Hを用いて計算速度の計測を行いました．</p><p><img src=compare.png alt=compare></p><p>Aはgroupby操作をアルゴリズムAのみを用いており，Bはgroupby操作をアルゴリズムBのみを用いています．
autoはgroupby操作についてグループ数の推定とアルゴリズムAとBの自動選択をしています．
アルゴリズムAとアルゴリズムBの実行時間にほとんど差がない処理については上のグラフでは省略しています．
グラフから，q10を除く処理で自動判定アルゴリズムは，アルゴリズムAとアルゴリズムBのうち速い方のアルゴリズムの選択ができていることが分かります．
totalはアルゴリズムA,アルゴリズムB,自動選択アルゴリズムについて上記グラフから除いた処理も含めたTPC-H全体の計算時間を示しています．
このことからTPC-H全体において，自動判定アルゴリズムはアルゴリズムAに対して3倍程度高速化ができており，
アルゴリズムBに対しては1.2倍程度高速化ができていることが分かります．</p><h2 id=参考>参考</h2><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>M. Bressan, E. Peserico, and L. Pretto. Simple set cardinality estimation through random sampling. CoRR, abs/1512.07901, 2015.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/ja/posts/2023-12-04-ishizaka/ aria-label="前へ - FireDucksのご紹介" class="btn btn-primary"><span class=me-1>←</span>前へ</a></li><li><a href=/ja/posts/2023-12-08-ohno/ aria-label="次へ - FireDucks の GroupBy アルゴリズム切替えについての解説" class="btn btn-primary">次へ<span class=ms-1>→</span></a></li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="Post issues on GitHub issues" aria-label="Post issues on GitHub issues"><a target=_blank rel=noopener href=https://github.com/fireducks-dev/fireducks aria-label="Post issues on GitHub issues"><i class="fa-brands fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Send an e-mail to us" aria-label="Send an e-mail to us"><a target=_blank rel=noopener href=mailto:contact@fireducks.jp.nec.com aria-label="Send an e-mail to us"><i class="fa-solid fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Follow us in X" aria-label="Follow us in X"><a target=_blank rel=noopener href=https://x.com/fireducksdev aria-label="Follow us in X"><i class="fa-brands fa-x-twitter"></i></a></li></ul></div><div class="col-6 col-sm-4 text-end text-xs-center order-sm-3"></div><div class="td-footer__copyright-etc col-12 col-sm-4 text-center py-2 order-sm-2"><span>&copy; 2024 FireDucks Dev Team All Rights Reserved</span></div></div></div></footer></div><script src=/js/main.min.350b703200e2632331b6ab5a6c71195d176b52e89c9b70db7c43764d40b28d92.js integrity="sha256-NQtwMgDiYyMxtqtabHEZXRdrUuicm3DbfEN2TUCyjZI=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>