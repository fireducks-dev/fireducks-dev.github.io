<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=ja class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>インポートフック：ソースコードを書き換えずに FireDucks を使う方法のご紹介 | FireDucks</title>
<meta name=description content="インポートフック機能を使えばソースコードを1行も書き換えずに FireDucks を使えるようにすることができます"><meta property="og:title" content="インポートフック：ソースコードを書き換えずに FireDucks を使う方法のご紹介"><meta property="og:description" content="インポートフック機能を使えばソースコードを1行も書き換えずに FireDucks を使えるようにすることができます"><meta property="og:type" content="article"><meta property="og:url" content="https://fireducks-dev.github.io/ja/posts/importhook/"><meta property="og:image" content="https://fireducks-dev.github.io/images/fireducks_1200x630.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-11-15T09:35:10+09:00"><meta property="article:modified_time" content="2023-11-15T09:35:10+09:00"><meta itemprop=name content="インポートフック：ソースコードを書き換えずに FireDucks を使う方法のご紹介"><meta itemprop=description content="インポートフック機能を使えばソースコードを1行も書き換えずに FireDucks を使えるようにすることができます"><meta itemprop=datePublished content="2023-11-15T09:35:10+09:00"><meta itemprop=dateModified content="2023-11-15T09:35:10+09:00"><meta itemprop=wordCount content="187"><meta itemprop=image content="https://fireducks-dev.github.io/images/fireducks_1200x630.png"><meta itemprop=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://fireducks-dev.github.io/images/fireducks_1200x630.png"><meta name=twitter:title content="インポートフック：ソースコードを書き換えずに FireDucks を使う方法のご紹介"><meta name=twitter:description content="インポートフック機能を使えばソースコードを1行も書き換えずに FireDucks を使えるようにすることができます"><link rel=preload href=/scss/main.min.2404b01c5fb65f0b4d76f0c632723d405f2faf20557f5aeff94d8efb2e91ec8b.css as=style><link href=/scss/main.min.2404b01c5fb65f0b4d76f0c632723d405f2faf20557f5aeff94d8efb2e91ec8b.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.3.min.js integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin=anonymous></script></head><body class="td-page td-blog"><header><nav class="td-navbar navbar-dark js-navbar-scroll"><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/ja/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>FireDucks</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/ja/docs/get-started><span>Get Started</span></a></li><li class=nav-item><a class=nav-link href=/ja/docs/user-guide/01-intro/><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=/ja/posts><span>Blogs</span></a></li><li class=nav-item><a class=nav-link href=/ja/docs/benchmarks><span>Benchmarks</span></a></li><li class=nav-item><a class=nav-link href=/ja/docs/about-us><span>About Us</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Japanese</a><ul class=dropdown-menu><li><a class=dropdown-item href=/posts/importhook/>English</a></li></ul></div></li></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><div class="td-sidebar-nav__section nav-item dropdown d-block d-lg-none"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>Japanese</a><ul class=dropdown-menu><li><a class=dropdown-item href=/posts/importhook/>English</a></li></ul></div></div><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-japosts-li><a href=/ja/posts/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-japosts><span>Posts</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japosts2023-12-24-ishizaka-li><a href=https://qiita.com/iszk1215/items/4916799360bfafd57bc4 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-japosts2023-12-24-ishizaka><i class="fa fa-external-link"></i><span>FireDucks vs Polars 42勝24敗！ あなたはどっちを使ってpandasを高速化する！？</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japosts2023-12-20-daido-li><a href=https://qiita.com/shu_ohm1/items/33642646f5c055066cfe target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-japosts2023-12-20-daido><i class="fa fa-external-link"></i><span>FireDucks に隠し機能を作ろうと思ったけどボツになった話</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japosts2023-12-18-araki-li><a href=https://qiita.com/takuya-araki/items/38c3554ba72c9eb274ba target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-japosts2023-12-18-araki><i class="fa fa-external-link"></i><span>FireDucksにおける最適化処理の紹介</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japosts2023-12-15-ishizaka-li><a href=https://qiita.com/iszk1215/items/2c6385fa575de378a619 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-japosts2023-12-15-ishizaka><i class="fa fa-external-link"></i><span>FireDucksを支える技術</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japosts2023-12-08-ohno-li><a href=https://qiita.com/ysyk-ohno/items/ddaaeca630d741a78f14 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-japosts2023-12-08-ohno><i class="fa fa-external-link"></i><span>FireDucks の GroupBy アルゴリズム切替えについての解説</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japostsest-li><a href=/ja/posts/est/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-japostsest><span>FireDucks内部で働く高速化技術</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japosts2023-12-04-ishizaka-li><a href=https://qiita.com/iszk1215/items/abe7621d9f6754de690a target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-japosts2023-12-04-ishizaka><i class="fa fa-external-link"></i><span>FireDucksのご紹介</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japosts2023-12-01-daido-li><a href=https://qiita.com/shu_ohm1/items/b0a35cfb4fce5b71c715 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-japosts2023-12-01-daido><i class="fa fa-external-link"></i><span>FireDucks のインポートフック機能にまつわるエトセトラ</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-japostsimporthook-li><a href=/ja/posts/importhook/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-japostsimporthook><span class=td-sidebar-nav-active-item>インポートフック：ソースコードを書き換えずに FireDucks を使う方法のご紹介</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japostsnes_taxi-li><a href=/ja/posts/nes_taxi/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-japostsnes_taxi><span>Pythonの高速データフレームライブラリFireDucksを使ってみた</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-japoststtdc-li><a href=https://jpn.nec.com/rd/technologies/202312/index.html target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-japoststtdc><i class="fa fa-external-link"></i><span>導入事例：トヨタテクニカルディベロップメント株式会社様 「Spicy MINT」</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#インポートフックの動作例>インポートフックの動作例</a></li><li><a href=#制限事項>制限事項</a><ul><li><a href=#shebang-未対応>shebang 未対応</a></li><li><a href=#他のモジュール実行オプションとの同時指定不可>他のモジュール実行オプションとの同時指定不可</a></li><li><a href=#サブプロセス非対応>サブプロセス非対応</a></li></ul></li></ul><ul><li><a href=#ipython-cli-での起動方法>IPython CLI での起動方法</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><a class=td-rss-button title=RSS href=https://fireducks-dev.github.io/ja/posts/index.xml target=_blank rel=noopener><i class="fa-solid fa-rss" aria-hidden=true></i></a><div class=td-content><h1>インポートフック：ソースコードを書き換えずに FireDucks を使う方法のご紹介</h1><div class=lead>インポートフック機能を使えばソースコードを1行も書き換えずに FireDucks を使えるようにすることができます</div><div class="td-byline mb-4"><time datetime=2023-11-15 class=text-muted>Wednesday, November 15, 2023</time></div><header class=article-meta></header><p>FireDucks 開発チームの大道です．今日は開発者ブログとして，FireDucks に備わっているインポートフック機能をご紹介したいと思います．この機能を使えば，お手持ちのソースコードを1行も書き換えることなく FireDucks を使うことができるようになります．</p><p>コマンドラインから Python ファイルを実行する際の使い方と，IPython や Jupyter Notebook での使い方を見ていきましょう．</p><h1 id=インポートフックとは>インポートフックとは？</h1><p>FireDucks はオリジナルの pandas と同じように振る舞うため，インポート文を以下のように書き換えるだけで簡単に使い始めることができます．</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># import pandas as pd</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> fireducks.pandas <span style=color:#66d9ef>as</span> pd
</span></span></code></pre></div><p>しかしたかが1行書き換えるだけとはいえ，今まで作成してきたプログラムで pandas を使用している部分を探して全部 FireDucks に置き換えるのは，意外と面倒くさいものです．また，pandas と連携するサードパーティライブラリでも FireDucks を使用したい場合，そのライブラリの中にまで手を入れて <code>import pandas</code> を書き換える作業は，普通はしたくないでしょう．</p><p><a href=/ja/docs/get-started/#import-hook>Get Started</a> でも触れられている通り，FireDucks にはインポートフックというユーティリティが含まれています．コマンドラインで <code>your_script.py</code> を実行する際に，Python インタープリターに以下のようにオプションを指定してください．</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>python3 -m fireducks.imhook your_script.py
</span></span></code></pre></div><p>以上のようにして起動すると，<code>pandas</code> をインポートしようとしたら代わりに <code>fireducks.pandas</code> がインポートされるようになります．これは <code>your_script.py</code> のソースコードを編集しているわけではなく，プログラムを実行しながら動的にインポート処理に割り込んでいます．</p><h2 id=インポートフックの動作例>インポートフックの動作例</h2><p>以下のような簡単な Python スクリプト <code>print_classname.py</code> で動作を確認してみましょう．このスクリプトでは DataFrame クラスの repr 表現が出力されます．</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span>print(pd<span style=color:#f92672>.</span>DataFrame)
</span></span></code></pre></div><p>普通に実行すると以下のような出力ですが…．</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ python3 print_classname.py
</span></span><span style=display:flex><span>&lt;class <span style=color:#e6db74>&#39;pandas.core.frame.DataFrame&#39;</span>&gt;
</span></span></code></pre></div><p>インポートフック機能を使って実行すると以下のような出力に変わります！ 🥳</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ python3 -m fireducks.imhook print_classname.py
</span></span><span style=display:flex><span>&lt;class <span style=color:#e6db74>&#39;fireducks.pandas.frame.DataFrame&#39;</span>&gt;
</span></span></code></pre></div><p>ソースコードを編集していないのに FireDucks のデータフレームが使えるようになっていることがわかります．</p><h2 id=制限事項>制限事項</h2><h3 id=shebang-未対応>shebang 未対応</h3><p>現在のところ，shebang (<code>#!...</code>) による実行には対応していません．</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/python3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span>print(pd<span style=color:#f92672>.</span>DataFrame)
</span></span></code></pre></div><p>Python インタープリターに <code>-m</code> オプションを指定できないため，インポートフックを有効化できません（そりゃそうだ）．</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ chmod +x print_classname_shebang.py
</span></span><span style=display:flex><span>$ ./print_classname_shebang.py
</span></span><span style=display:flex><span>&lt;class <span style=color:#e6db74>&#39;pandas.core.frame.DataFrame&#39;</span>&gt;
</span></span></code></pre></div><h3 id=他のモジュール実行オプションとの同時指定不可>他のモジュール実行オプションとの同時指定不可</h3><p>Python インタープリターの起動時には <code>-m</code> オプションはひとつしか指定できないため，<code>-m</code> オプションを使って起動する他のツールと同時に使うことはできません．</p><h3 id=サブプロセス非対応>サブプロセス非対応</h3><p><code>subprocess</code> モジュールを使って Python プロセスを新たに起動した場合，そのサブプロセスにインポートフックの設定は受け継がれません．</p><h1 id=jupyter-notebook-での使い方>Jupyter Notebook での使い方</h1><p>インポートフックは Jupyter Notebook でも利用することができます．ただし現在のところ，Jupyter を起動する際のオプションとしては利用できず，ノートブックの最初のセルで明示的に有効化する必要があります．</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> fireducks.importhook
</span></span><span style=display:flex><span>fireducks<span style=color:#f92672>.</span>importhook<span style=color:#f92672>.</span>activate_hook(<span style=color:#e6db74>&#34;fireducks.pandas&#34;</span>, <span style=color:#e6db74>&#34;pandas&#34;</span>)
</span></span></code></pre></div><p>自分で書いたノートブック内で pandas をインポートするだけならインポートフックを使うメリットはあまりないかもしれません．しかし，pandas と連携するようなサードパーティライブラリの中ででもインポートフックは働くため，そのようなライブラリをノートブックから使用する場合に便利です．</p><p>無効化する場合は以下の関数を実行してください．</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>fireducks<span style=color:#f92672>.</span>importhook<span style=color:#f92672>.</span>deactivate_hook()
</span></span></code></pre></div><p>ただし，オリジナルの pandas のデータフレームと FireDucks のデータフレームを混ぜて使うと（恐らく複雑怪奇なエラーメッセージとともに）エラーが発生します．基本的には一度インポートフックを有効化したら有効化しっぱなしにしておきましょう．</p><h2 id=ipython-cli-での起動方法>IPython CLI での起動方法</h2><p>IPython の場合，先述した Jupyter Notebook での使い方と同じように手動で有効化してもいいのですが，bash などでは以下のようにして IPython CLI を起動することもできます．</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>python3 -m fireducks.imhook <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>which ipython<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><p>うーん…，ちょっと無理矢理ですね！</p><h1 id=まとめにかえて>まとめにかえて</h1><p>FireDucks はまだまだ研究開発中のソフトウェアで，pandas で動いていたプログラムで FireDucks を使うように変更しても，エラーになってしまって動かない部分があるかもしれません．私たち FireDucks 開発チームではベータ版を公開してからも日々機能改善に取り組んでおり，エラー報告など，皆さんからのフィードバックをお待ちしております．<a href=/ja/docs/help/contact/>連絡先はこちら</a>を参照してください．</p><p>以上，ソースコードを1行も書き換えずに FireDucks を使う方法のご紹介でした．FireDucks を使ってみたいと思った方は <a href=/ja/docs/get-started/>Get Started</a> や<a href=/ja/docs/user-guide/01-intro/>ユーザーガイド</a>，pandas との速度比較が気になる方は<a href=/ja/docs/benchmarks/>ベンチマーク</a>も読んでみてくださいね．</p><p>May the Acceleration be with you,
FireDucks 開発チーム</p><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/ja/posts/nes_taxi/ aria-label="前へ - Pythonの高速データフレームライブラリFireDucksを使ってみた" class="btn btn-primary"><span class=me-1>←</span>前へ</a></li><li><a href=/ja/posts/2023-12-01-daido/ aria-label="次へ - FireDucks のインポートフック機能にまつわるエトセトラ" class="btn btn-primary">次へ<span class=ms-1>→</span></a></li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="Post issues on GitHub issues" aria-label="Post issues on GitHub issues"><a target=_blank rel=noopener href=https://github.com/fireducks-dev/fireducks aria-label="Post issues on GitHub issues"><i class="fa-brands fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Send an e-mail to us" aria-label="Send an e-mail to us"><a target=_blank rel=noopener href=mailto:contact@fireducks.jp.nec.com aria-label="Send an e-mail to us"><i class="fa-solid fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Follow us in X" aria-label="Follow us in X"><a target=_blank rel=noopener href=https://x.com/fireducksdev aria-label="Follow us in X"><i class="fa-brands fa-x-twitter"></i></a></li></ul></div><div class="col-6 col-sm-4 text-end text-xs-center order-sm-3"></div><div class="td-footer__copyright-etc col-12 col-sm-4 text-center py-2 order-sm-2"><span>&copy; 2024 FireDucks Dev Team All Rights Reserved</span></div></div></div></footer></div><script src=/js/main.min.350b703200e2632331b6ab5a6c71195d176b52e89c9b70db7c43764d40b28d92.js integrity="sha256-NQtwMgDiYyMxtqtabHEZXRdrUuicm3DbfEN2TUCyjZI=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>