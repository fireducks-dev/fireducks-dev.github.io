<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://fireducks-dev.github.io/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://fireducks-dev.github.io/fonts/vendor/jost/jost-v4-latin-500.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://fireducks-dev.github.io/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><link rel=stylesheet href=https://fireducks-dev.github.io/main.280962f974eb82354c447978a6574463448ea8c1d8e7874c8642a004f5713d4dba64daa30b7bc622b650b58c5de2666e72015e3d2cc02195358f9693469d5b94.css integrity="sha512-KAli+XTrgjVMRHl4pldEY0SOqMHY54dMhkKgBPVxPU26ZNqjC3vGIrZQtYxd4mZucgFePSzAIZU1j5aTRp1blA==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Using Python's fast data frame library FireDucks - FireDucks</title><meta name=description content="FireDucks is a fast DataFrame python library with pandas-api"><link rel=canonical href=https://fireducks-dev.github.io/en/posts/nes_taxi/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Using Python's fast data frame library FireDucks"><meta property="og:description" content="FireDucks is a fast DataFrame python library with pandas-api"><meta property="og:url" content="https://fireducks-dev.github.io/en/posts/nes_taxi/"><meta property="og:site_name" content="FireDucks"><meta property="article:published_time" content="2023-10-23T08:47:36+00:00"><meta property="article:modified_time" content="2023-10-23T08:47:36+00:00"><meta property="og:image" content="https://fireducks-dev.github.io/fireducks.png"><meta property="og:image:alt" content="FireDucks"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@fireducksdev"><meta name=twitter:creator content="@fireducksdev"><meta name=twitter:title content="Using Python's fast data frame library FireDucks"><meta name=twitter:description content="FireDucks is a fast DataFrame python library with pandas-api"><meta name=twitter:image content="https://fireducks-dev.github.io/fireducks.png"><meta name=twitter:image:alt content="Using Python's fast data frame library FireDucks"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://fireducks-dev.github.io/#/schema/organization/1","name":"FireDucks","url":"https://fireducks-dev.github.io/","sameAs":["https://twitter.com/fireducks","https://github.com/fireducks-dev"],"logo":{"@type":"ImageObject","@id":"https://fireducks-dev.github.io/#/schema/image/1","url":"https://fireducks-dev.github.io/fireducks.png","width":666,"height":298,"caption":"FireDucks"},"image":{"@id":"https://fireducks-dev.github.io/#/schema/image/1"}},{"@type":"WebSite","@id":"https://fireducks-dev.github.io/#/schema/website/1","url":"https://fireducks-dev.github.io/","name":"FireDucks","description":"FireDucks is a fast dataframe python library with pandas api","publisher":{"@id":"https://fireducks-dev.github.io/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://fireducks-dev.github.io/en/posts/nes_taxi/","url":"https://fireducks-dev.github.io/en/posts/nes_taxi/","name":"Using Python\u0027s fast data frame library FireDucks","description":"FireDucks is a fast DataFrame python library with pandas-api","isPartOf":{"@id":"https://fireducks-dev.github.io/#/schema/website/1"},"about":{"@id":"https://fireducks-dev.github.io/#/schema/organization/1"},"datePublished":"2023-10-23T08:47:36CET","dateModified":"2023-10-23T08:47:36CET","breadcrumb":{"@id":"https://fireducks-dev.github.io/en/posts/nes_taxi/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://fireducks-dev.github.io/en/posts/nes_taxi/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://fireducks-dev.github.io/en/posts/nes_taxi/"]}]},{"@type":"BreadcrumbList","@id":"https://fireducks-dev.github.io/en/posts/nes_taxi/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://fireducks-dev.github.io/","url":"https://fireducks-dev.github.io/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://fireducks-dev.github.io/en/","url":"https://fireducks-dev.github.io/en/","name":"En"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://fireducks-dev.github.io/en/posts/","url":"https://fireducks-dev.github.io/en/posts/","name":"Posts"}},{"@type":"ListItem","position":4,"item":{"@id":"https://fireducks-dev.github.io/en/posts/nes_taxi/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://fireducks-dev.github.io/en/posts/nes_taxi/#/schema/image/2","url":"https://fireducks-dev.github.io/fireducks.png","contentUrl":"https://fireducks-dev.github.io/fireducks.png","caption":"Using Python\u0027s fast data frame library FireDucks"}]}]}</script><meta name=theme-color content="#fff"><link rel=icon href=https://fireducks-dev.github.io/favicon.ico sizes=any><link rel=apple-touch-icon sizes=180x180 href=https://fireducks-dev.github.io/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://fireducks-dev.github.io/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://fireducks-dev.github.io/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=https://fireducks-dev.github.io/site.webmanifest><base href=https://fireducks-dev.github.io/></head><body class="posts single"><div class=sticky-top><div class=header-bar></div><header class="navbar navbar-expand-lg navbar-light doks-navbar"><nav class="container-xxl flex-wrap flex-lg-nowrap" aria-label="Main navigation"><a class="navbar-brand order-0" href=/en/ aria-label=FireDucks>FireDucks</a>
<button class="btn btn-menu order-2 d-block d-lg-none" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-end border-0 py-lg-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-lg-none"></div><div class="offcanvas-header d-lg-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=/en/>FireDucks</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body p-4 p-lg-0"><ul class="nav flex-column flex-lg-row align-items-lg-center mt-2 mt-lg-0 ms-lg-2 me-lg-auto"><li class=nav-item><a class="nav-link ps-0 py-1" href=/en/docs/get-started/get-started/>Get Started</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=/en/docs/user-guide/01-intro/>Docs</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=/en/docs/benchmarks/benchmarks/>Benchmarks</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=/en/docs/about-us/about-us/>About Us</a></li></ul><hr class="text-black-50 my-4 d-lg-none"><form class="doks-search position-relative flex-grow-1 ms-lg-auto me-lg-2"><input id=search class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded d-none"></div></form><hr class="text-black-50 my-4 d-lg-none"><ul class="nav flex-column flex-lg-row"><li class=nav-item><a class="nav-link social-link" href=https://twitter.com/fireducksdev><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 1200 1227" fill="currentcolor" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M714.163 519.284 1160.89.0H1055.03L667.137 450.887 357.328.0H0L468.492 681.821.0 1226.37H105.866L515.491 750.218 842.672 1226.37H12e2L714.137 519.284H714.163zM569.165 687.828l-47.468-67.894L144.011 79.6944H306.615L611.412 515.685l47.468 67.894 396.2 566.721H892.476L569.165 687.854V687.828z"/></svg><small class="ms-2 d-lg-none">Twitter</small></a></li></ul><hr class="text-black-50 my-4 d-lg-none"><button id=mode class="btn btn-link" type=button aria-label="Toggle user interface mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><hr class="text-black-50 my-4 d-lg-none"><div class=dropdown><button class="btn btn-doks-light dropdown-toggle" id=doks-languages data-bs-toggle=dropdown aria-expanded=false data-bs-display=static>
English
<span class=dropdown-caret><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"/></svg></span></button><ul class="dropdown-menu dropdown-menu-lg-end me-lg-2 shadow rounded border-0" aria-labelledby=doks-languages><li><a class="dropdown-item current" aria-current=true href=/en/posts/nes_taxi/>English</a></li><li><hr class=dropdown-divider></li><li><a class=dropdown-item rel=alternate href=/ja/posts/nes_taxi/ hreflang=ja lang=ja>Japanese</a></li></ul></div><a class="btn btn-primary mb-1" href=/en/docs/get-started/get-started/#install>Try for Free</a></div></div></nav></header></div><div class="wrap container-xxl" role=document><div class=content><article><div class="row justify-content-center"><div class="col-md-12 col-lg-12"><div class=blog-header><h1>Using Python's fast data frame library FireDucks</h1><p><small>Posted&nbsp;on&nbsp;October 23, 2023 by
Yudai Morita</small></p></div></div><p><div class="col-md-12 col-lg-10 border border-primary border-2 mb-4">This article was written by Yudai Morita, who is engaged in data analysis at <a href=https://www.nec-solutioninnovators.co.jp/>NEC Solution Innovators, Ltd</a>.</div></p><div class="col-md-12 col-lg-12"><p>pandas is a library that provides functions to support data analysis in the Python programming language.
NEC Research Laboratories has developed a library called FireDucks, a faster version of pandas.</p><h2 id=data-preparation>Data Preparation <a href=#data-preparation class=anchor aria-hidden=true>#</a></h2><p>The analysis is performed on the data of passenger history of cabs in New York City.
The source of the data is as follows:</p><blockquote><p><a href=https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page>https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page</a></p></blockquote><p>To analyze large data sets, we downloaded and merged the &ldquo;Yellow Taxi Trip Records&rdquo; data from January 2022 to June 2023 from the above link.
The data is provided in parquet format, but I converted it to csv format for testing.
A script for preparing the data is included for reference.</p><pre><code class=language-python>import pandas as pd
import os

dir = &quot;xxx&quot;
df_list = []
for year in [2022, 2023]: for i in range(12)
    for i in range(12): for i = str(i+1).zfill(2)
        month = str(i+1).zfill(2)
        fn = f &quot;yellow_tripdata_{year}-{month}.parquet&quot;
        file = os.path.join(dir, fn)
        if not os.path.exists(file):
            continue
        df = pd.read_parquet(fn)
        df_list.append(df)

all_df = pd.concat(df_list)
all_df.to_csv(&quot;taxi_all.csv&quot;)
</code></pre><p>The contents of the data contains the following values (some columns are excerpts).</p><table><thead><tr><th>Column name</th><th><nobr>Data type</nobr></th><th>Description</th></tr></thead><tbody><tr><td><code>passenger_count</code></td><td>int</td><td>The number of passengers</td></tr><tr><td><code>pu_location_Id</code></td><td>string</td><td>The TLC cab zone where the cab meter started working.</td></tr><tr><td><code>do_location_Id</code></td><td>string</td><td>The TLC cab zone where the cab meter was deactivated.</td></tr><tr><td><code>tpep_dropoff_datetime</code></td><td>string</td><td>The date and time the meter was deactivated.</td></tr><tr><td><code>tpep_pickupdate_time</code></td><td>string</td><td>The date and time when the meter started to work.</td></tr><tr><td><code>trip_distance</code></td><td>double</td><td>The trip distance (in miles) reported by the cab meter.</td></tr><tr><td><code>total_amount</code></td><td>double</td><td>The total amount of money charged to the passenger, not including the cash tip.</td></tr><tr><td><code>extra</code></td><td>double</td><td>Other surcharges and additional charges. Currently, this includes only the $0.50 and $1 rush hour and nighttime fares.</td></tr><tr><td><code>fare_amount</code></td><td>double</td><td>Time-and-distance combined fare calculated by the meter.</td></tr></tbody></table><h2 id=actual-preprocessing>Actual preprocessing <a href=#actual-preprocessing class=anchor aria-hidden=true>#</a></h2><p>A series of preprocessing calculations, such as type conversion, column addition, and outlier deletion, which are often used in data analysis, are performed on the prepared data.</p><p>First, prepare a wrapper for speed measurement.
<code>_evaluate()</code> is described later.</p><pre><code class=language-python>from time import time
from functools import wraps

def timer(func):
    @wraps(func)
    def wp(*args, **kargs):
        t = time()
        ret = func(*args, **kargs)
        print(f&quot;{func.__name__} : {(time() - t):.5g} [sec]&quot;)
        return ret
    return wp

def evaluate(df):
    if hasattr(df, &quot;_evaluate&quot;):
        df._evaluate()
</code></pre><h3 id=loading-data>Loading data <a href=#loading-data class=anchor aria-hidden=true>#</a></h3><p>First, read the data.
Import pandas and then use <code>read_csv</code> to read the data.
Define a function, and call it later to measure the data.</p><pre><code class=language-python>import pandas as pd
</code></pre><pre><code class=language-python>@timer
def file_read(fn, args={}):
    df = pd.read_csv(fn, **args)
    evaluate(df)
    print(df.shape)
    return df
</code></pre><h3 id=data-processing>Data processing <a href=#data-processing class=anchor aria-hidden=true>#</a></h3><p>Remove data with missing values.</p><pre><code class=language-python>@timer
def drop_na(df):
    df.dropna(how=&quot;all&quot;, inplace=True)
    evaluate(df)
    return df
</code></pre><p>The date and time of boarding and alighting are read as strings, so they should be converted to dates.</p><pre><code class=language-python>@timer
def txt_to_date(df, low):
    df[low] = pd.to_datetime(df[low])
    evaluate(df)
    return df
</code></pre><p>Let&rsquo;s look at the distribution grouped by the number of boardings (print is not included in the performance evaluation, so it is omitted).
We see that there are data with zero riders, so we remove them.</p><pre><code class=language-python># At least one person on the train
@timer
def check_passenger_c(df):
    df_ = df.groupby(&quot;passenger_count&quot;).size()
    evaluate(df_)
    df = df[df[&quot;passenger_count&quot;] &gt; 0]
    evaluate(df)
    return df
</code></pre><p>Extract the year, month, day, and hour information from the ride date data and add columns.
The distribution of the year and month of the ride contains incorrect values, so we remove them.</p><pre><code class=language-python># correct ride year/month
@timer
def check_pu_date(df):
    df['year'] = df['tpep_pickup_datetime'].dt.year
    df['month'] = df['tpep_pickup_datetime'].dt.month
    df['date'] = df['tpep_pickup_datetime'].dt.day
    df['hour'] = df['tpep_pickup_datetime'].dt.hour

    df_ = df.groupby(&quot;year&quot;).size()
    evaluate(df_)
    df = df[(df['year'] == 2022) | (df['year'] == 2023)]

    df_ = df.groupby(&quot;month&quot;).size()
    evaluate(df_)
    df = df[(df['month'] &gt;= 1) &amp; df['month'] &lt;= 12]

    df_ = df.groupby([&quot;year&quot;, &quot;month&quot;]).size()
    evaluate(df_)
    evaluate(df)
    return df
</code></pre><p>Convert the difference between the disembarkation time and the ride time to minutes and add a column.
Remove non-positive or too long ride times.</p><pre><code class=language-python># realistic ride time in minutes
@timer
def check_ride_time(df):
    df[&quot;ride_time&quot;] = (df[&quot;tpep_dropoff_datetime&quot;] - df[&quot;tpep_pickup_datetime&quot;]).dt.seconds / 60
    df = df[(df[&quot;ride_time&quot;] &gt; 0) &amp; (df[&quot;ride_time&quot;] &lt;= 180)]
    evaluate(df)
    return df
</code></pre><p>Remove non-negative or too large values for ride distance and fare.</p><pre><code class=language-python># realistic distances
@timer
def check_trip_distance(df):
    df = df[(df[&quot;trip_distance&quot;] &gt; 0) &amp; (df[&quot;trip_distance&quot;] &lt;= 250)]
    evaluate(df)
    return df

# Realistic fares
@timer
def check_total_amount(df):
    df = df[(df[&quot;total_amount&quot;] &gt; 0) &amp; (df[&quot;total_amount&quot;] &lt;= 1000)]
    evaluate(df)
    return df
</code></pre><p>Calculate the latitude and longitude from the IDs of the boarding and alighting points.
The relationship between the ID and the point can be checked as follows:</p><blockquote><p><a href=https://d37ci6vzurychx.cloudfront.net/misc/taxi+_zone_lookup.csv>https://d37ci6vzurychx.cloudfront.net/misc/taxi+_zone_lookup.csv</a></p></blockquote><p>The columns are added by merging the conversion table created based on the latitude and longitude calculated from:</p><blockquote><p><a href=https://d37ci6vzurychx.cloudfront.net/misc/taxi_zones.zip>https://d37ci6vzurychx.cloudfront.net/misc/taxi_zones.zip</a></p></blockquote><p>Remove data outside New York City from the latitude and longitude information.</p><pre><code class=language-python># Find latitude and longitude from IDs
@timer
def add_coordinate(df, ID_df):
    df = df.merge(ID_df.rename(columns={&quot;longitude&quot;: &quot;start_lon&quot;, &quot;latitude&quot;: &quot;start_lat&quot;}),
                  left_on=&quot;PULocationID&quot;, right_on=&quot;LocationID&quot;, how=&quot;left&quot;).drop(&quot;LocationID&quot;, axis=1)
    df = df.merge(ID_df.rename(columns={&quot;longitude&quot;: &quot;end_lon&quot;, &quot;latitude&quot;: &quot;end_lat&quot;}),
                  left_on=&quot;DOLocationID&quot;, right_on=&quot;LocationID&quot;, how=&quot;left&quot;).drop(&quot;LocationID&quot;, axis=1)
    evaluate(df)
    return df

# Check if it is in NY
@timer
def in_NY(df):
    df = df[(df[&quot;start_lon&quot;] &lt;= -71.47) &amp; (df[&quot;start_lon&quot;] &gt;= -79.45)]
    df = df[(df[&quot;start_lat&quot;] &gt;= 40.29) &amp; (df[&quot;start_lat&quot;] &lt;= 45)]
    df = df[(df[&quot;end_lon&quot;] &lt;= -71.47) &amp; (df[&quot;end_lon&quot;] &gt;= -79.45)]
    df = df[(df[&quot;end_lat&quot;] &gt;= 40.29) &amp; (df[&quot;end_lat&quot;] &lt;= 45)]
    evaluate(df)
    return df

def check_in_NY(df, ID_df):
    df = add_coordinate(df, ID_df)
    df = in_NY(df)
    return df
</code></pre><p>As described above, a series of processes are prepared to read data, perform type conversion, add columns, and remove outlier values.</p><ol><li>Read the file</li><li>Convert date data from string to date data</li><li>Preprocessing<ol><li>Remove missing values</li><li>Check the number of passengers<ol><li>Check distribution by groupby</li><li>Select at least 1 passenger</li></ol></li><li>Check the time of boarding<ol><li>Tet the year, month, date and time from the date data and add a column</li><li>Group by year and check -> Select only the relevant year</li><li>Group by month and check -> select only Jan-Dec</li><li>Group by year and month and check the distribution</li></ol></li><li>Check the boarding time<ol><li>Take the difference between the time of disembarkation and the time of embarkation, convert to minutes, and add a column (<code>dt.total_second</code> is not supported by FireDucks)</li><li>Select realistic ride time data</li></ol></li><li>Check the ride distance<ol><li>Select realistic distance data</li></ol></li><li>Check fare<ol><li>Select realistic fare data</li></ol></li><li>Select NY City data<ol><li>Merge the passenger ID with the latitude and longitude table</li><li>Select the data where the longitude and latitude of the boarding and alighting is in NY city</li></ol></li></ol></li></ol><h2 id=execution-time-in-pandas>Execution time in pandas <a href=#execution-time-in-pandas class=anchor aria-hidden=true>#</a></h2><p>First, let&rsquo;s check the execution time on pandas.
A 24-core Xeon server (Intel(R) Xeon(R) Gold 6226 CPU x 2, 256GB main memory) was used for the measurement.</p><pre><code class=language-python>import os
data_path = &quot;data_sets&quot;
fn = os.path.join(data_path, &quot;taxi_all.csv&quot;)
ID_file = os.path.join(data_path, &quot;ID_to_coordinate.csv&quot;)

need_cols = ['tpep_pickup_datetime','tpep_dropoff_datetime', 'passenger_count', 'trip_distance',
'PULocationID', 'DOLocationID', 'total_amount', 'improvement_surcharge', 'extra', 'fare_amount', 'RatecodeID']

@timer
def Preprocessing():
    df = file_read(fn, {&quot;usecols&quot;: need_cols})
    ID_df = file_read(ID_file)

    df = txt_to_date(df, &quot;tpep_pickup_datetime&quot;)
    df = txt_to_date(df, &quot;tpep_dropoff_datetime&quot;)

    df = drop_na(df)
    df = check_passenger_c(df)
    df = check_pu_date(df)
    df = check_ride_time(df)
    df = check_trip_distance(df)
    df = check_total_amount(df)
    df = check_in_NY(df, ID_df)
    evaluate(df)
    return df

df = Preprocessing()
</code></pre><p>Now, the execution time in pandas is as shown in the table below.
The two <code>file_read</code> files are due to reading the taxi data as well as the location data for merging, and the <code>txt_to_date</code> file is due to converting the ride time and the drop-off time.
The execution time shows that it took more than one minute to read the file.
In addition, <code>check_pu_date</code> and <code>add_coordinate</code>, which include adding columns and merge processing, take more than 30 seconds, and the implemented preprocessing takes 186 seconds to complete.</p><h2 id=execution-time-with-fireducks>Execution time with FireDucks <a href=#execution-time-with-fireducks class=anchor aria-hidden=true>#</a></h2><p>Measure the execution time when using FireDucks with the imported library replaced by pandas.</p><pre><code class=language-shell>pip install fireducks
</code></pre><p>The above scripts for pandas preprocessing can be used as-is by importing FireDucks, since FireDucks is compatible with pandas.</p><pre><code class=language-python>import fireducks.pandas as pd
</code></pre><p>Note that FireDucks does not immediately execute methods when they are called.
Therefore, it is necessary to run <code>_evaluate()</code> to measure the execution time of each method.</p><p>The following table compares the execution time of FireDucks with that of pandas after importing FireDucks and performing the same preprocessing calculations.</p><table><thead><tr><th style=text-align:left>Function</th><th style=text-align:right>pandas [sec]</th><th style=text-align:right>FireDucks [sec]</th><th style=text-align:right>Speed-up ratio</th></tr></thead><tbody><tr><td style=text-align:left><code>file_read</code></td><td style=text-align:right>72.19</td><td style=text-align:right>3.52</td><td style=text-align:right>20.49</td></tr><tr><td style=text-align:left><code>file_read</code></td><td style=text-align:right>0.003</td><td style=text-align:right>0.01</td><td style=text-align:right>0.38</td></tr><tr><td style=text-align:left><code>txt_to_date</code></td><td style=text-align:right>9.07</td><td style=text-align:right>19.10</td><td style=text-align:right>0.48</td></tr><tr><td style=text-align:left><code>txt_to_date</code></td><td style=text-align:right>8.57</td><td style=text-align:right>20.57</td><td style=text-align:right>0.42</td></tr><tr><td style=text-align:left><code>drop_na</code></td><td style=text-align:right>3.13</td><td style=text-align:right>0.70</td><td style=text-align:right>4.47</td></tr><tr><td style=text-align:left><code>check_passenger_c</code></td><td style=text-align:right>3.21</td><td style=text-align:right>1.80</td><td style=text-align:right>1.79</td></tr><tr><td style=text-align:left><code>check_pu_date</code></td><td style=text-align:right>27.37</td><td style=text-align:right>0.99</td><td style=text-align:right>27.64</td></tr><tr><td style=text-align:left><code>check_ride_time</code></td><td style=text-align:right>7.02</td><td style=text-align:right>2.00</td><td style=text-align:right>3.51</td></tr><tr><td style=text-align:left><code>check_trip_distance</code></td><td style=text-align:right>3.24</td><td style=text-align:right>0.91</td><td style=text-align:right>3.55</td></tr><tr><td style=text-align:left><code>check_total_amount</code></td><td style=text-align:right>3.11</td><td style=text-align:right>0.93</td><td style=text-align:right>3.59</td></tr><tr><td style=text-align:left><code>check_total_amount</code></td><td style=text-align:right>3.11</td><td style=text-align:right>0.93</td><td style=text-align:right>3.59</td></tr><tr><td style=text-align:left><code>in_NY</code></td><td style=text-align:right>20.75</td><td style=text-align:right>2.71</td><td style=text-align:right>7.65</td></tr><tr><td style=text-align:left><code>Preprocessing</code></td><td style=text-align:right>186.02</td><td style=text-align:right>54.92</td><td style=text-align:right>3.39</td></tr></tbody></table><p>The <code>file_read</code> process took more than 70 seconds to complete in pandas, but it took about 3.5 seconds, which is more than 20 times faster.
Other time-consuming processes (<code>check_pu_date</code>, <code>add_coordinate</code>) were also significantly reduced.</p><p>The computation time for <code>txt_to_date</code> was increased by using FireDucks.
This is because the <code>to_datetime()</code> function is not supported by FireDucks at the time of writing.
However, even when a function like <code>to_datetime()</code> is called that does not support acceleration, FireDucks does not return an error because it performs the calculation by calling a pandas function.</p><p>The total computation time for the preprocessing calculations in this article was 55 seconds with FireDucks, compared to 186 seconds with pandas, which is about 3.4 times faster.
Of the 55 seconds, about 40 seconds was for processing that had not yet been accelerated, and further acceleration is expected in the future.</p></div></div></article></div></div><footer class="footer text-muted"><div class=container-xxl><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Powered by <a class=text-muted href=https://gohugo.io/>Hugo</a> and <a class=text-muted href=https://getdoks.org/>Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div></div></div></footer><script src=/js/bootstrap.min.7315382e899a7d7132d93fdf0d6682c67a93f0e72ee1a757f33f3207de3b14e2460a935c9d4cec78f86d94ab892d053c70540695eed0bbb7bf5bdc979e6f5a9f.js integrity="sha512-cxU4LomafXEy2T/fDWaCxnqT8Ocu4adX8z8yB947FOJGCpNcnUzsePhtlKuJLQU8cFQGle7Qu7e/W9yXnm9anw==" crossorigin=anonymous defer></script>
<script src=/js/highlight.min.8b2d7ddd72ba2c88d5107387eb3b66b90f1f864fd5afef6aed284425efb5919a9bc092f653f2985a205b85b0a158f70b460643ba2b71ccf7d3c1c107c3a4b609.js integrity="sha512-iy193XK6LIjVEHOH6ztmuQ8fhk/Vr+9q7ShEJe+1kZqbwJL2U/KYWiBbhbChWPcLRgZDuitxzPfTwcEHw6S2CQ==" crossorigin=anonymous defer></script>
<script src=/main.min.57d9a84956f7d60008c47938c7fdd2f75e8618ff1d09c5a5e2b32f91debaf7681f7ceca8b51aded60067c2136172134a91ebc0674487c76a04e3244d927ebdde.js integrity="sha512-V9moSVb31gAIxHk4x/3S916GGP8dCcWl4rMvkd6692gffOyotRre1gBnwhNhchNKkevAZ0SHx2oE4yRNkn693g==" crossorigin=anonymous defer></script>
<script src=https://fireducks-dev.github.io/index.min.e7cb668cf26edca68c5bcbe2b5c4950f0835bcb142801580624033e71dedcc4a2b495a1803c656616a87f8a6567deafddbfc63d239053b5a816d31fc45b67b9a.js integrity="sha512-58tmjPJu3KaMW8vitcSVDwg1vLFCgBWAYkAz5x3tzEorSVoYA8ZWYWqH+KZWfer92/xj0jkFO1qBbTH8RbZ7mg==" crossorigin=anonymous defer></script></body></html>