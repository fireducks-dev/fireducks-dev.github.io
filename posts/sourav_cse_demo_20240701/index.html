<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Have you ever thought of speeding up your data analysis in pandas with a compiler? | FireDucks</title>
<meta name=description content="In general, a Data Scientist spends significant efforts in transforming the raw data into a more digestible format before training an AI model or creating visualizations. Traditional tools such as pandas have long been the linchpin in this process, offering powerful capabilities but not without limitations.
With the pitfall of its single-core implementation and inefficient data structures, often we face performance issues when dealing with pandas for relatively larger data, but its performance is also highly impacted by the choice of APIs, their parameters and execution orders."><meta property="og:title" content="Have you ever thought of speeding up your data analysis in pandas with a compiler?"><meta property="og:description" content="In general, a Data Scientist spends significant efforts in transforming the raw data into a more digestible format before training an AI model or creating visualizations. Traditional tools such as pandas have long been the linchpin in this process, offering powerful capabilities but not without limitations.
With the pitfall of its single-core implementation and inefficient data structures, often we face performance issues when dealing with pandas for relatively larger data, but its performance is also highly impacted by the choice of APIs, their parameters and execution orders."><meta property="og:type" content="article"><meta property="og:url" content="https://fireducks-dev.github.io/posts/sourav_cse_demo_20240701/"><meta property="og:image" content="https://fireducks-dev.github.io/index_banner.webp"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-07-01T00:00:00+00:00"><meta property="article:modified_time" content="2024-07-01T00:00:00+00:00"><meta itemprop=name content="Have you ever thought of speeding up your data analysis in pandas with a compiler?"><meta itemprop=description content="In general, a Data Scientist spends significant efforts in transforming the raw data into a more digestible format before training an AI model or creating visualizations. Traditional tools such as pandas have long been the linchpin in this process, offering powerful capabilities but not without limitations.
With the pitfall of its single-core implementation and inefficient data structures, often we face performance issues when dealing with pandas for relatively larger data, but its performance is also highly impacted by the choice of APIs, their parameters and execution orders."><meta itemprop=datePublished content="2024-07-01T00:00:00+00:00"><meta itemprop=dateModified content="2024-07-01T00:00:00+00:00"><meta itemprop=wordCount content="1487"><meta itemprop=image content="https://fireducks-dev.github.io/index_banner.webp"><meta itemprop=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://fireducks-dev.github.io/index_banner.webp"><meta name=twitter:title content="Have you ever thought of speeding up your data analysis in pandas with a compiler?"><meta name=twitter:description content="In general, a Data Scientist spends significant efforts in transforming the raw data into a more digestible format before training an AI model or creating visualizations. Traditional tools such as pandas have long been the linchpin in this process, offering powerful capabilities but not without limitations.
With the pitfall of its single-core implementation and inefficient data structures, often we face performance issues when dealing with pandas for relatively larger data, but its performance is also highly impacted by the choice of APIs, their parameters and execution orders."><link rel=preload href=/scss/main.min.2404b01c5fb65f0b4d76f0c632723d405f2faf20557f5aeff94d8efb2e91ec8b.css as=style><link href=/scss/main.min.2404b01c5fb65f0b4d76f0c632723d405f2faf20557f5aeff94d8efb2e91ec8b.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.3.min.js integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin=anonymous></script></head><body class="td-page td-blog"><header><nav class="td-navbar navbar-dark js-navbar-scroll"><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>FireDucks</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/get-started><span>Get Started</span></a></li><li class=nav-item><a class=nav-link href=/docs/user-guide/01-intro/><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=/posts><span>Blogs</span></a></li><li class=nav-item><a class=nav-link href=/docs/benchmarks><span>Benchmarks</span></a></li><li class=nav-item><a class=nav-link href=/talks><span>Talks</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/fireducks-dev/fireducks/issues target=_blank rel=noopener><span>Report Issue</span></a></li><li class=nav-item><a class=nav-link href=/docs/about-us><span>About Us</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><ul class=dropdown-menu><li><a class=dropdown-item href=/ja/>Japanese</a></li></ul></div></li></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><div class="td-sidebar-nav__section nav-item dropdown d-block d-lg-none"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><ul class=dropdown-menu><li><a class=dropdown-item href=/ja/>Japanese</a></li></ul></div></div><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-posts-li><a href=/posts/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-posts><span>Posts</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsdata_flow_optimization-li><a href=/posts/data_flow_optimization/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsdata_flow_optimization><span>Unveiling the Optimization Benefit of FireDucks Lazy Execution: Part #3</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts2024-12-26-time-pitfalls-li><a href=/posts/2024-12-26-time-pitfalls/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts2024-12-26-time-pitfalls><span>Pitfalls of Time Measurement for FireDucks with %%time in Notebooks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts2024-12-20-trace-li><a href=/posts/2024-12-20-trace/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts2024-12-20-trace><span>How to take traces in FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts2024-12-19-araki-en-li><a href=/posts/2024-12-19-araki-en/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts2024-12-19-araki-en><span>Ensuring compatibility with pandas in the GPU version of FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postscudf_vs_fireducks-li><a href=/posts/cudf_vs_fireducks/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postscudf_vs_fireducks><span>Exploring performance benefits of FireDucks over cuDF</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20241217_liveness_analysis-li><a href=/posts/20241217_liveness_analysis/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20241217_liveness_analysis><span>Cache or Eliminate? How FireDucks increase opportunity of optimization</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20241206_update_polars-tpch-li><a href=/posts/20241206_update_polars-tpch/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20241206_update_polars-tpch><span>How to run polars-tpch benchmark with FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postslazy_execution_offering_part1-li><a href=/posts/lazy_execution_offering_part1/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postslazy_execution_offering_part1><span>Unveiling the Optimization Benefit of FireDucks Lazy Execution: Part #1</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsefficient_caching-li><a href=/posts/efficient_caching/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsefficient_caching><span>Unveiling the Optimization Benefit of FireDucks Lazy Execution: Part #2</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsbeginner_guide-li><a href=/posts/beginner_guide/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsbeginner_guide><span>What to do when FireDucks is slow</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20240919-workshop-li><a href=/posts/20240919-workshop/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20240919-workshop><span>Workshop at Bangalore, India</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-postssourav_cse_demo_20240701-li><a href=/posts/sourav_cse_demo_20240701/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-postssourav_cse_demo_20240701><span class=td-sidebar-nav-active-item>Have you ever thought of speeding up your data analysis in pandas with a compiler?</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts2024-05-08-medium-li><a href=https://medium.com/@fireducks/introduction-to-fireducks-get-performance-beyond-pandas-with-zero-learning-cost-8694d4eab9c6 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts2024-05-08-medium><i class="fa fa-external-link"></i><span>Introduction to FireDucks: Get performance beyond pandas with zero learning cost!</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsneci4-li><a href=https://medium.com/@ashu.thakur/backtesting-trading-strategies-with-ease-an-excursion-with-fireducks-e771b701dcd5 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsneci4><i class="fa fa-external-link"></i><span>Backtesting Trading Strategies with Ease: An excursion with FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsneci3-li><a href=https://medium.com/@ashu.thakur/fireducks-diving-into-api-compatibility-with-pandas-e8f4111c2f98 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsneci3><i class="fa fa-external-link"></i><span>FireDucks: Diving into API Compatibility with Pandas</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsneci2-li><a href=https://medium.com/@ashu.thakur/choosing-your-data-champion-a-side-by-side-look-at-fireducks-and-polars-51c144fd4689 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsneci2><i class="fa fa-external-link"></i><span>Choosing Your Data Champion: A Side-by-Side Look at FireDucks and Polars</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsneci1-li><a href=https://medium.com/@ashu.thakur/boosting-data-analysis-with-fireducks-0066ad25966d target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsneci1><i class="fa fa-external-link"></i><span>Boosting Data Analysis with FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20231216-sourav-li><a href=https://qiita.com/qsourav/items/5c06426fae5f3df0244c target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20231216-sourav><i class="fa fa-external-link"></i><span>A hidden fact you must know when working with pandas</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20231211-sourav-li><a href=https://qiita.com/qsourav/items/1c1fe15faa06fce1dd33 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20231211-sourav><i class="fa fa-external-link"></i><span>Tricks to improve computational performance of JOIN operation more than 10x</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20231207-sourav-li><a href=https://qiita.com/qsourav/items/e87f25c4b307391d784a target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20231207-sourav><i class="fa fa-external-link"></i><span>FireDucks - An economical and environment-friendly high-performance solution for your complex Data Analysis</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20231206-sourav-li><a href=https://qiita.com/qsourav/items/cc4ca4c8d4668ce617bf target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20231206-sourav><i class="fa fa-external-link"></i><span>One thing you might be doing wrong in pandas!!</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsest-li><a href=/posts/est/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsest><span>Acceleration technology inside FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsimporthook-li><a href=/posts/importhook/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsimporthook><span>Import hooks: how to use FireDucks without modifying your programs</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsnes_taxi-li><a href=/posts/nes_taxi/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsnes_taxi><span>Using Python's fast data frame library FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-poststtdc-li><a href=https://www.nec.com/en/global/rd/technologies/202312/index.html target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-poststtdc><i class="fa fa-external-link"></i><span>Application example: Spicy MINT at Toyota Technical Development Corporation</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#notebook-example-01>:notebook: Example 01</a></li><li><a href=#notebook-example-02>:notebook: Example 02</a></li><li><a href=#notebook-example-03>:notebook: Example 03</a></li><li><a href=#point_right-new-information-alert>:point_right: New Information alert!</a></li><li><a href=#fire-bird-what-does-it-offer>:fire: :bird: What does it offer?</a></li><li><a href=#computer-demonstration>:computer: Demonstration</a></li><li><a href=#point_right-how-does-fireducks-work>:point_right: How does FireDucks work?</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><a class=td-rss-button title=RSS href=https://fireducks-dev.github.io/posts/index.xml target=_blank rel=noopener><i class="fa-solid fa-rss" aria-hidden=true></i></a><div class=td-content><h1>Have you ever thought of speeding up your data analysis in pandas with a compiler?</h1><div class="td-byline mb-4">By <b>Sourav Saha</b> |
<time datetime=2024-07-01 class=text-muted>Monday, July 01, 2024</time></div><header class=article-meta></header><p>In general, a Data Scientist spends significant efforts in transforming the raw data into a more
digestible format before training an AI model or creating visualizations. Traditional tools such
as pandas have long been the linchpin in this process, offering powerful capabilities but not
without limitations.</p><p>With the pitfall of its single-core implementation and inefficient data structures,
often we face performance issues when dealing with pandas for relatively larger data,
but its performance is also highly impacted by the choice of APIs, their parameters and execution orders.
Sometime an efficient writing of a pandas application can itself make it 10-20x faster.</p><p>In this article, I will discuss a few commonly used examples picked up from some pandas applications.</p><h2 id=notebook-example-01>:notebook: Example 01</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame()
</span></span><span style=display:flex><span>s <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>Series([<span style=color:#e6db74>&#34;2020-10-10&#34;</span>, <span style=color:#e6db74>&#34;2021-11-20&#34;</span>, <span style=color:#e6db74>&#34;2022-08-03&#34;</span>, <span style=color:#e6db74>&#34;2023-07-04&#34;</span>])
</span></span><span style=display:flex><span>df[<span style=color:#e6db74>&#34;year&#34;</span>] <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>to_datetime(s)<span style=color:#f92672>.</span>dt<span style=color:#f92672>.</span>year
</span></span><span style=display:flex><span>df[<span style=color:#e6db74>&#34;month&#34;</span>] <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>to_datetime(s)<span style=color:#f92672>.</span>dt<span style=color:#f92672>.</span>month
</span></span><span style=display:flex><span>df[<span style=color:#e6db74>&#34;day&#34;</span>] <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>to_datetime(s)<span style=color:#f92672>.</span>dt<span style=color:#f92672>.</span>day
</span></span></code></pre></div><p>We can clearly identify the major issue with the above code is using the expression, <code>pd.to_datetime(s)</code> three times.
The purpose is to extract the year, month and day fields from the series data (s) of type &ldquo;datetime64[ns]&rdquo;.
The method to_datetime() attempts to parse the input string column in order to convert it to a datetime column
(along with inferring the format if not specified). Such parsing itself is very expensive when performed on a large data
and if the same expression on the same input is written more than one time, its very obvious that the program will
experience a significant performance issue.</p><p>As you might have clearly figured out, an optimized solution to this problem could be:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame()
</span></span><span style=display:flex><span>s <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>Series([<span style=color:#e6db74>&#34;2020-10-10&#34;</span>, <span style=color:#e6db74>&#34;2021-11-20&#34;</span>, <span style=color:#e6db74>&#34;2022-08-03&#34;</span>, <span style=color:#e6db74>&#34;2023-07-04&#34;</span>])
</span></span><span style=display:flex><span>dt_s <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>to_datetime(s)
</span></span><span style=display:flex><span>df[<span style=color:#e6db74>&#34;year&#34;</span>] <span style=color:#f92672>=</span> dt_s<span style=color:#f92672>.</span>dt<span style=color:#f92672>.</span>year
</span></span><span style=display:flex><span>df[<span style=color:#e6db74>&#34;month&#34;</span>] <span style=color:#f92672>=</span> dt_s<span style=color:#f92672>.</span>dt<span style=color:#f92672>.</span>month
</span></span><span style=display:flex><span>df[<span style=color:#e6db74>&#34;day&#34;</span>] <span style=color:#f92672>=</span> dt_s<span style=color:#f92672>.</span>dt<span style=color:#f92672>.</span>day
</span></span></code></pre></div><p>This is a very basic example which can be manually optimized, if reviewed carefully after an application is developed.
Let&rsquo;s take another example which is very common when performing an extensive data analysis.</p><h2 id=notebook-example-02>:notebook: Example 02</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>res <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># To find industry-wise average salary of an Indian employee</span>
</span></span><span style=display:flex><span>res[<span style=color:#e6db74>&#34;industry_wise_avg_sal&#34;</span>] <span style=color:#f92672>=</span> (
</span></span><span style=display:flex><span>  employee[employee[<span style=color:#e6db74>&#34;country&#34;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;India&#34;</span>]
</span></span><span style=display:flex><span>   <span style=color:#f92672>.</span>groupby(<span style=color:#e6db74>&#34;industry&#34;</span>)[<span style=color:#e6db74>&#34;salary&#34;</span>]
</span></span><span style=display:flex><span>   <span style=color:#f92672>.</span>mean()
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># To find industry-wise average salary of an Indian employee who are above 30</span>
</span></span><span style=display:flex><span>res[<span style=color:#e6db74>&#34;industry_wise_avg_sal_for_specific_age_group&#34;</span>] <span style=color:#f92672>=</span> (
</span></span><span style=display:flex><span>  employee[(employee[<span style=color:#e6db74>&#34;country&#34;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;India&#34;</span>) <span style=color:#f92672>&amp;</span> (employee[<span style=color:#e6db74>&#34;age&#34;</span>] <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>30</span>)]
</span></span><span style=display:flex><span>   <span style=color:#f92672>.</span>groupby(<span style=color:#e6db74>&#34;industry&#34;</span>)[<span style=color:#e6db74>&#34;salary&#34;</span>]
</span></span><span style=display:flex><span>   <span style=color:#f92672>.</span>mean()
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(res)
</span></span></code></pre></div><p>Both of these queries have a common expression to be evaluated during the filter operation, i.e.,
checking whether the employee belongs to India (comparison on String column is itself very costly than comparison on numeric columns).
Now, imagine if we are dealing with an extensively large employee database, then evaluating <code>employee["country"] == "India"</code> for two
times can be quite an expensive operation that can easily be optimized with the same strategy as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># To generate the required filtration masks in advance</span>
</span></span><span style=display:flex><span>cond1 <span style=color:#f92672>=</span> (employee[<span style=color:#e6db74>&#34;country&#34;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;India&#34;</span>)
</span></span><span style=display:flex><span>cond2 <span style=color:#f92672>=</span> (employee[<span style=color:#e6db74>&#34;age&#34;</span>] <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>30</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>res <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame()
</span></span><span style=display:flex><span><span style=color:#75715e># To find industry-wise average salary of an Indian employee</span>
</span></span><span style=display:flex><span>res[<span style=color:#e6db74>&#34;industry_wise_avg_sal&#34;</span>] <span style=color:#f92672>=</span> (
</span></span><span style=display:flex><span>  employee[cond1]
</span></span><span style=display:flex><span>   <span style=color:#f92672>.</span>groupby(<span style=color:#e6db74>&#34;industry&#34;</span>)[<span style=color:#e6db74>&#34;salary&#34;</span>]
</span></span><span style=display:flex><span>   <span style=color:#f92672>.</span>mean()
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># To find industry-wise average salary of an Indian employee who are above 30</span>
</span></span><span style=display:flex><span>res[<span style=color:#e6db74>&#34;industry_wise_avg_sal_for_specific_age_group&#34;</span>] <span style=color:#f92672>=</span> (
</span></span><span style=display:flex><span>  employee[cond1 <span style=color:#f92672>&amp;</span> cond2]
</span></span><span style=display:flex><span>   <span style=color:#f92672>.</span>groupby(<span style=color:#e6db74>&#34;industry&#34;</span>)[<span style=color:#e6db74>&#34;salary&#34;</span>]
</span></span><span style=display:flex><span>   <span style=color:#f92672>.</span>mean()
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(res)
</span></span></code></pre></div><p>In compiler technology, such optimization is called as
<strong><a href=https://en.wikipedia.org/wiki/Common_subexpression_elimination>common sub-expression elimination (CSE)</a></strong> and
can essentially be performed by a smart compiler in programming language like C/C++.</p><h2 id=notebook-example-03>:notebook: Example 03</h2><p>Let&rsquo;s take another example of a compiler optimization technique:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>func</span>(x: pd<span style=color:#f92672>.</span>DataFrame, y: pd<span style=color:#f92672>.</span>DataFrame):
</span></span><span style=display:flex><span>    merged <span style=color:#f92672>=</span> x<span style=color:#f92672>.</span>merge(y, on<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;key&#34;</span>)
</span></span><span style=display:flex><span>    sorted <span style=color:#f92672>=</span> merged<span style=color:#f92672>.</span>sort_values(by<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;key&#34;</span>) <span style=color:#75715e># is never used</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> merged<span style=color:#f92672>.</span>groupby(<span style=color:#e6db74>&#34;key&#34;</span>)<span style=color:#f92672>.</span>max()
</span></span></code></pre></div><p>The method is trying to merge two input tables, x and y followed by a groupby-aggregate operation.
The &ldquo;sort&rdquo; operation is also a part of the method after merging the tables, but it is actually not
required from the method context (since the sorted result is never used within the method).
Sometime when we focus on very detail exploration of the input data, it is very common that such piece of
unwanted code remains in our application resulting a significant performance cost.</p><p>Hence, an optimized solution to the above method could be:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>func</span>(x: pd<span style=color:#f92672>.</span>DataFrame, y: pd<span style=color:#f92672>.</span>DataFrame):
</span></span><span style=display:flex><span>    merged <span style=color:#f92672>=</span> x<span style=color:#f92672>.</span>merge(y, on<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;key&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> merged<span style=color:#f92672>.</span>groupby(<span style=color:#e6db74>&#34;key&#34;</span>)<span style=color:#f92672>.</span>max()
</span></span></code></pre></div><p>In compiler technology, such optimization is called as
<strong><a href=https://en.wikipedia.org/wiki/Dead-code_elimination>dead code elimination</a></strong> and
is very important from the overall performance point of view of any application.</p><p>An expert programmer might take care of such cases while developing his data analysis solutions, but as a data analyst our
primary focus is to explore more about the data from different verticals and horizontals to find out meaningful insights
while solving some business problems or creating important features for our training data. Hence we often miss to take care
of such issues. Nowadays, there are many good linters that will point out such issues, so a manual optimization is definitely
possible if you include the linter execution step as part of your TODO action when developing an application.</p><h2 id=point_right-new-information-alert>:point_right: New Information alert!</h2><p>Let&rsquo;s now talk about an ideal scenario!</p><p>How would it be if such optimization is automatically taken care by the python data manipulation library we use?</p><p>It can save us from taking care of such issues by ourselves and can significantly improve the performance of our application, right?</p><p>Well, the wait is over! Let me introduce a high-performance DataFrame library,
named <strong><a href=https://fireducks-dev.github.io/>FireDucks</a></strong> with highly compatible pandas APIs,
powered by <a href=https://mlir.llvm.org/>MLIR（Multi-Level Intermediate Representation)</a>
framework to have such powerful compiler optimization abilities.</p><p>The library is carefully developed at NEC R&amp;D laboratory over last 3 years and is freely available to be installed using
&ldquo;pip&rdquo; under BSD licence since October, 2023.</p><h2 id=fire-bird-what-does-it-offer>:fire: :bird: What does it offer?</h2><p>FireDucks is developed with the following points in mind:</p><ul><li><p>Automatic query optimization ability with lazy-execution model.</p><ul><li>A data analyst can focus more on exploring data, while the inbuilt compiler of FireDucks can take care of the following:<ol><li>basic compiler optimizations, like common sub-expression elimination, dead code elimination etc.</li><li>domain specific optimizations, like execution reordering, dropping unwanted columns in advance etc.</li><li>pandas specific optimizations, like choice of right APIs when executing a query (by careful analysis of the application objective), choice of right parameters by avoiding unwanted operations (like sorting of result etc.)</li></ol></li></ul></li><li><p>A pandas user can flexibly adapt to this library without any new learning cost.</p><ul><li>FireDucks is highly compatible with pandas, so any pandas application can be optimized without any manual code changes. Doesn&rsquo;t it sound quite promising?</li></ul></li><li><p>The program can leverage all the available cores in the execution environment:</p><ul><li>The single-core execution issue in pandas is solved!</li></ul></li></ul><h2 id=computer-demonstration>:computer: Demonstration</h2><p>Here is a <a href="https://colab.research.google.com/drive/1mPv6kuOlWckubPBuCaUgmTg0Ip6zQAuO?usp=sharing">link</a> for a test drive with
a sample walkthrough notebook on Google Colab which shows how easy it is to start with FireDucks and its performance gain over
pandas for a sample CSE use-case (Example 01 of this article).</p><p>With a low-spec execution environment having 2 cores, where pandas takes 1.3 seconds to execute a sample query,
FireDucks (with multhreaded + compiler enabled) takes only 166 milli-seconds.
Such speedup (~8x) without incurring any migration cost (no cost involves in rewritting the application from
pandas to FireDucks) or any special hardware cost seems quite beneficial from the overall production cost point of view.</p><p>In case you are interested to see how it performs for popular benchmarks (like TPC-H, db-benchmark etc.) in comparison to
other high-performance pandas alternatives, you may like to check <a href=https://fireducks-dev.github.io/docs/benchmarks/>this</a> out.</p><h2 id=point_right-how-does-fireducks-work>:point_right: How does FireDucks work?</h2><p>FireDucks comes with three powerful layers:</p><ul><li>a python frontend highly compatible with pandas APIs</li><li>an in-built compiler to auto-detect and optimize the exsting performance issues in a user program</li><li>a multithreaded C++ backend with efficient parallel implementation of all the dataframe related operations like join, filter, groupby sort etc.</li></ul><p>Unlike pandas that executes the library functions right after they are called, FireDucks creates some special instructions and keep them accumulated until there is some explicit request for the result (print result, do some reduction, to_csv etc.). Before the execution, the in-built compiler inspects all the accumulated instructions related to the result to be processed and performs some automatic optimization (as explained above) and then the optimized instructions are executed at the multithreaded kernel backend helping us to focus more on our analytical work and be more productive.</p><p><img src=https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2917078/9d3e5cf5-048c-889e-9efd-ac60f4c3e924.png alt=pandas_fireducks_exec_model.png></p><h1 id=-conclusion>✍️ Conclusion</h1><p>FireDucks shows promise by taking care of all the drawbacks associated with pandas and
its compiler optimization technology makes it one of its kind. This article introduces FireDucks basic compilation optimization
abilities as mentioned in (a). In upcoming articles, I will demonstrate other powerful optimization areas (b and c)
automatically taken care of by FireDucks. If you like this article, please be with me to check them out as well.
You may like to try FireDucks and share your feedback. I would love to answer to whatever queries you may have
in mind with the best of my knowledge. The development team is very active and there is a new release almost
every week with performance improvements, new features based on user requests, bug fixes etc.
You may like to get in touch with them directly through the
<a href=https://join.slack.com/t/fireducks/shared_invite/zt-34qpdgr6q-_iWdIoZW4l_hGhljKS0pyg>slack channel</a>.</p><p>You may also like to checkout one of my previous <a href=https://qiita.com/qsourav/items/e87f25c4b307391d784a>articles</a> on FireDucks salient features.</p><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/posts/2024-05-08-medium/ aria-label="Previous - Introduction to FireDucks: Get performance beyond pandas with zero learning cost!" class="btn btn-primary"><span class=me-1>←</span>Previous</a></li><li><a href=/posts/20240919-workshop/ aria-label="Next - Workshop at Bangalore, India" class="btn btn-primary">Next<span class=ms-1>→</span></a></li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="Post issues on GitHub issues" aria-label="Post issues on GitHub issues"><a target=_blank rel=noopener href=https://github.com/fireducks-dev/fireducks aria-label="Post issues on GitHub issues"><i class="fa-brands fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Send an e-mail to us" aria-label="Send an e-mail to us"><a target=_blank rel=noopener href=mailto:contact@fireducks.jp.nec.com aria-label="Send an e-mail to us"><i class="fa-solid fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Follow us in X" aria-label="Follow us in X"><a target=_blank rel=noopener href=https://x.com/fireducksdev aria-label="Follow us in X"><i class="fa-brands fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Join us on Slack" aria-label="Join us on Slack"><a target=_blank rel=noopener href=https://join.slack.com/t/fireducks/shared_invite/zt-34qpdgr6q-_iWdIoZW4l_hGhljKS0pyg aria-label="Join us on Slack"><i class="fa-brands fa-slack"></i></a></li></ul></div><div class="col-6 col-sm-4 text-end text-xs-center order-sm-3"></div><div class="td-footer__copyright-etc col-12 col-sm-4 text-center py-2 order-sm-2"><span>&copy; 2025 FireDucks Dev Team All Rights Reserved</span></div></div></div></footer></div><script src=/js/main.min.350b703200e2632331b6ab5a6c71195d176b52e89c9b70db7c43764d40b28d92.js integrity="sha256-NQtwMgDiYyMxtqtabHEZXRdrUuicm3DbfEN2TUCyjZI=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>