<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Pitfalls of Time Measurement for FireDucks with %%time in Notebooks | FireDucks</title>
<meta name=description content="We will explore the pitfalls of using the `%%time` magic command in Jupyter and other IPython Notebooks to measure the execution time of FireDucks processes."><meta property="og:title" content="Pitfalls of Time Measurement for FireDucks with %%time in Notebooks"><meta property="og:description" content="We will explore the pitfalls of using the `%%time` magic command in Jupyter and other IPython Notebooks to measure the execution time of FireDucks processes."><meta property="og:type" content="article"><meta property="og:url" content="https://fireducks-dev.github.io/posts/2024-12-26-time-pitfalls/"><meta property="og:image" content="https://fireducks-dev.github.io/images/fireducks_1200x630.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-26T09:35:10+09:00"><meta property="article:modified_time" content="2024-12-26T09:35:10+09:00"><meta itemprop=name content="Pitfalls of Time Measurement for FireDucks with %%time in Notebooks"><meta itemprop=description content="We will explore the pitfalls of using the `%%time` magic command in Jupyter and other IPython Notebooks to measure the execution time of FireDucks processes."><meta itemprop=datePublished content="2024-12-26T09:35:10+09:00"><meta itemprop=dateModified content="2024-12-26T09:35:10+09:00"><meta itemprop=wordCount content="1016"><meta itemprop=image content="https://fireducks-dev.github.io/images/fireducks_1200x630.png"><meta itemprop=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://fireducks-dev.github.io/images/fireducks_1200x630.png"><meta name=twitter:title content="Pitfalls of Time Measurement for FireDucks with %%time in Notebooks"><meta name=twitter:description content="We will explore the pitfalls of using the `%%time` magic command in Jupyter and other IPython Notebooks to measure the execution time of FireDucks processes."><link rel=preload href=/scss/main.min.2404b01c5fb65f0b4d76f0c632723d405f2faf20557f5aeff94d8efb2e91ec8b.css as=style><link href=/scss/main.min.2404b01c5fb65f0b4d76f0c632723d405f2faf20557f5aeff94d8efb2e91ec8b.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.3.min.js integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin=anonymous></script></head><body class="td-page td-blog"><header><nav class="td-navbar navbar-dark js-navbar-scroll"><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>FireDucks</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/get-started><span>Get Started</span></a></li><li class=nav-item><a class=nav-link href=/docs/user-guide/01-intro/><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=/posts><span>Blogs</span></a></li><li class=nav-item><a class=nav-link href=/docs/benchmarks><span>Benchmarks</span></a></li><li class=nav-item><a class=nav-link href=/talks><span>Talks</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/fireducks-dev/fireducks/issues target=_blank rel=noopener><span>Report Issue</span></a></li><li class=nav-item><a class=nav-link href=/docs/about-us><span>About Us</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><ul class=dropdown-menu><li><a class=dropdown-item href=/ja/posts/2024-12-26-time-pitfalls/>Japanese</a></li></ul></div></li></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><div class="td-sidebar-nav__section nav-item dropdown d-block d-lg-none"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><ul class=dropdown-menu><li><a class=dropdown-item href=/ja/posts/2024-12-26-time-pitfalls/>Japanese</a></li></ul></div></div><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-posts-li><a href=/posts/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-posts><span>Posts</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-posts2024-12-26-time-pitfalls-li><a href=/posts/2024-12-26-time-pitfalls/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-posts2024-12-26-time-pitfalls><span class=td-sidebar-nav-active-item>Pitfalls of Time Measurement for FireDucks with %%time in Notebooks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts2024-12-20-trace-li><a href=/posts/2024-12-20-trace/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts2024-12-20-trace><span>How to take traces in FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts2024-12-19-araki-en-li><a href=/posts/2024-12-19-araki-en/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts2024-12-19-araki-en><span>Ensuring compatibility with pandas in the GPU version of FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postscudf_vs_fireducks-li><a href=/posts/cudf_vs_fireducks/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postscudf_vs_fireducks><span>Exploring performance benefits of FireDucks over cuDF</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20241217_liveness_analysis-li><a href=/posts/20241217_liveness_analysis/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20241217_liveness_analysis><span>Cache or Eliminate? How FireDucks increase opportunity of optimization</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20241206_update_polars-tpch-li><a href=/posts/20241206_update_polars-tpch/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20241206_update_polars-tpch><span>How to run polars-tpch benchmark with FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postslazy_execution_offering_part1-li><a href=/posts/lazy_execution_offering_part1/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postslazy_execution_offering_part1><span>Unveiling the Optimization Benefit of FireDucks Lazy Execution: Part #1</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsefficient_caching-li><a href=/posts/efficient_caching/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsefficient_caching><span>Unveiling the Optimization Benefit of FireDucks Lazy Execution: Part #2</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsbeginner_guide-li><a href=/posts/beginner_guide/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsbeginner_guide><span>What to do when FireDucks is slow</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20240919-workshop-li><a href=/posts/20240919-workshop/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20240919-workshop><span>Workshop at Bangalore, India</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postssourav_cse_demo_20240701-li><a href=/posts/sourav_cse_demo_20240701/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postssourav_cse_demo_20240701><span>Have you ever thought of speeding up your data analysis in pandas with a compiler?</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts2024-05-08-medium-li><a href=https://medium.com/@fireducks/introduction-to-fireducks-get-performance-beyond-pandas-with-zero-learning-cost-8694d4eab9c6 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts2024-05-08-medium><i class="fa fa-external-link"></i><span>Introduction to FireDucks: Get performance beyond pandas with zero learning cost!</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsneci4-li><a href=https://medium.com/@ashu.thakur/backtesting-trading-strategies-with-ease-an-excursion-with-fireducks-e771b701dcd5 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsneci4><i class="fa fa-external-link"></i><span>Backtesting Trading Strategies with Ease: An excursion with FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsneci3-li><a href=https://medium.com/@ashu.thakur/fireducks-diving-into-api-compatibility-with-pandas-e8f4111c2f98 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsneci3><i class="fa fa-external-link"></i><span>FireDucks: Diving into API Compatibility with Pandas</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsneci2-li><a href=https://medium.com/@ashu.thakur/choosing-your-data-champion-a-side-by-side-look-at-fireducks-and-polars-51c144fd4689 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsneci2><i class="fa fa-external-link"></i><span>Choosing Your Data Champion: A Side-by-Side Look at FireDucks and Polars</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsneci1-li><a href=https://medium.com/@ashu.thakur/boosting-data-analysis-with-fireducks-0066ad25966d target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsneci1><i class="fa fa-external-link"></i><span>Boosting Data Analysis with FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20231216-sourav-li><a href=https://qiita.com/qsourav/items/5c06426fae5f3df0244c target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20231216-sourav><i class="fa fa-external-link"></i><span>A hidden fact you must know when working with pandas</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20231211-sourav-li><a href=https://qiita.com/qsourav/items/1c1fe15faa06fce1dd33 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20231211-sourav><i class="fa fa-external-link"></i><span>Tricks to improve computational performance of JOIN operation more than 10x</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20231207-sourav-li><a href=https://qiita.com/qsourav/items/e87f25c4b307391d784a target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20231207-sourav><i class="fa fa-external-link"></i><span>FireDucks - An economical and environment-friendly high-performance solution for your complex Data Analysis</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20231206-sourav-li><a href=https://qiita.com/qsourav/items/cc4ca4c8d4668ce617bf target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20231206-sourav><i class="fa fa-external-link"></i><span>One thing you might be doing wrong in pandas!!</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsest-li><a href=/posts/est/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsest><span>Acceleration technology inside FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsimporthook-li><a href=/posts/importhook/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsimporthook><span>Import hooks: how to use FireDucks without modifying your programs</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsnes_taxi-li><a href=/posts/nes_taxi/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsnes_taxi><span>Using Python's fast data frame library FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-poststtdc-li><a href=https://www.nec.com/en/global/rd/technologies/202312/index.html target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-poststtdc><i class="fa fa-external-link"></i><span>Application example: Spicy MINT at Toyota Technical Development Corporation</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#quick-overview>Quick Overview</a></li><li><a href=#time-measurement-in-notebooks>Time Measurement in Notebooks</a><ul><li><a href=#time-measurement-for-fireducks>Time Measurement for FireDucks</a></li><li><a href=#example-of-incorrect-time-measurement>Example of Incorrect Time Measurement</a></li><li><a href=#example-of-correct-time-measurement>Example of Correct Time Measurement</a></li><li><a href=#slightly-different-solution>Slightly Different Solution</a></li></ul></li><li><a href=#wrap-up>Wrap-up</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><a class=td-rss-button title=RSS href=https://fireducks-dev.github.io/posts/index.xml target=_blank rel=noopener><i class="fa-solid fa-rss" aria-hidden=true></i></a><div class=td-content><h1>Pitfalls of Time Measurement for FireDucks with %%time in Notebooks</h1><div class=lead>We will explore the pitfalls of using the <code>%%time</code> magic command in Jupyter and other IPython Notebooks to measure the execution time of FireDucks processes.</div><div class="td-byline mb-4">By <b>Osamu Daido</b> |
<time datetime=2024-12-26 class=text-muted>Thursday, December 26, 2024</time></div><header class=article-meta></header><p>This is Osamu Daido from the FireDucks development team. In today's developers' blog, I would like to present a subtle pitfall in time measurement.</p><h2 id=quick-overview>Quick Overview</h2><p>When measuring the execution time of FireDucks using the <code>%%time</code> magic command in IPython Notebooks, make sure to always call the <code>_evaluate()</code> method of DataFrames or Series to ensure proper evaluation!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>%%</span>time
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(<span style=color:#e6db74>&#34;input.csv&#34;</span>)
</span></span><span style=display:flex><span>df<span style=color:#f92672>.</span>_evaluate()
</span></span></code></pre></div><h2 id=time-measurement-in-notebooks>Time Measurement in Notebooks</h2><p>Jupyter and other IPython Notebooks provide the <code>%%time</code> magic command to measure the execution time of the code written in a cell. For instance, a single percent sign <code>%time</code> measures the execution time of only one line of code, while double percent signs <code>%%time</code> measure the execution time for the entire cell. You may be interested in or curious about measuring the execution time of FireDucks because it can process data faster while offering the same API as pandas.</p><p>However&mldr;, hmm? Do you think the following time measurement is correct?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> fireducks.pandas <span style=color:#66d9ef>as</span> pd
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>%%</span>time
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(<span style=color:#e6db74>&#34;sample-dataset-tips.csv&#34;</span>)
</span></span><span style=display:flex><span>df<span style=color:#f92672>.</span>head()
</span></span></code></pre></div><blockquote><pre><code>CPU times: user 3.37 ms, sys: 4.06 ms, total: 7.43 ms
Wall time: 6.87 ms
</code></pre><table><thead><tr><th style=text-align:right></th><th style=text-align:right>total_bill</th><th style=text-align:right>tip</th><th style=text-align:right>sex</th><th style=text-align:right>smoker</th><th style=text-align:right>day</th><th style=text-align:right>time</th><th style=text-align:right>size</th></tr></thead><tbody><tr><td style=text-align:right>0</td><td style=text-align:right>16.99</td><td style=text-align:right>1.01</td><td style=text-align:right>Female</td><td style=text-align:right>No</td><td style=text-align:right>Sun</td><td style=text-align:right>Dinner</td><td style=text-align:right>2</td></tr><tr><td style=text-align:right>1</td><td style=text-align:right>10.34</td><td style=text-align:right>1.66</td><td style=text-align:right>Male</td><td style=text-align:right>No</td><td style=text-align:right>Sun</td><td style=text-align:right>Dinner</td><td style=text-align:right>3</td></tr><tr><td style=text-align:right>2</td><td style=text-align:right>21.01</td><td style=text-align:right>3.50</td><td style=text-align:right>Male</td><td style=text-align:right>No</td><td style=text-align:right>Sun</td><td style=text-align:right>Dinner</td><td style=text-align:right>3</td></tr><tr><td style=text-align:right>3</td><td style=text-align:right>23.68</td><td style=text-align:right>3.31</td><td style=text-align:right>Male</td><td style=text-align:right>No</td><td style=text-align:right>Sun</td><td style=text-align:right>Dinner</td><td style=text-align:right>2</td></tr><tr><td style=text-align:right>4</td><td style=text-align:right>24.59</td><td style=text-align:right>3.61</td><td style=text-align:right>Female</td><td style=text-align:right>No</td><td style=text-align:right>Sun</td><td style=text-align:right>Dinner</td><td style=text-align:right>4</td></tr></tbody></table></blockquote><h3 id=time-measurement-for-fireducks>Time Measurement for FireDucks</h3><p>As explained on <a href=/docs/user-guide/02-exec-model/>the execution model page</a>, FireDucks uses a lazy execution model. In simple terms, FireDucks DataFrames do not begin actual processing until explicitly displayed on the screen with functions like <code>print()</code> or <code>display()</code>, or when the <code>_evaluate()</code> method is called. FireDucks can process data more quickly by optimizing the accumulated operations before executing them. This execution of accumulated operations is referred to as &ldquo;evaluation.&rdquo;</p><p>In IPython Notebooks, if the last line of a cell is not an assignment statement but simply a value, it is automatically displayed on the screen, similar to the Python interpreter's REPL. In IPython terms, it's as if <code>display()</code> is automatically called. This means that if you place a FireDucks DataFrame at the end of a cell, it will also be automatically evaluated.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(<span style=color:#e6db74>&#34;sample-dataset-tips.csv&#34;</span>)
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>sort_values(by<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;tip&#34;</span>)
</span></span><span style=display:flex><span>df  <span style=color:#75715e># THIS!</span>
</span></span></code></pre></div><p>However, there is a subtle pitfall when you want to measure execution time using the <code>%%time</code> magic command. Just because placing a FireDucks DataFrame at the end of a cell triggers automatic evaluation, it does not necessarily mean that the correct execution time is measured.</p><h3 id=example-of-incorrect-time-measurement>Example of Incorrect Time Measurement</h3><p>I prepared a CSV file of about 10GB for experimentation. When executing the following cell, something strange happens.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>%%</span>time
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(<span style=color:#e6db74>&#34;sample-dataset-tips10gb.csv&#34;</span>)
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>sort_values(by<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;tip&#34;</span>)
</span></span><span style=display:flex><span>df
</span></span></code></pre></div><blockquote><pre><code>CPU times: user 18.2 ms, sys: 4.31 ms, total: 22.5 ms
Wall time: 15.2 ms
</code></pre><table><thead><tr><th style=text-align:right></th><th style=text-align:right>total_bill</th><th style=text-align:right>tip</th><th style=text-align:right>sex</th><th style=text-align:right>smoker</th><th style=text-align:right>day</th><th style=text-align:right>time</th><th style=text-align:right>size</th></tr></thead><tbody><tr><td style=text-align:right>67</td><td style=text-align:right>3.07</td><td style=text-align:right>1.0</td><td style=text-align:right>Female</td><td style=text-align:right>Yes</td><td style=text-align:right>Sat</td><td style=text-align:right>Dinner</td><td style=text-align:right>1</td></tr><tr><td style=text-align:right>92</td><td style=text-align:right>5.75</td><td style=text-align:right>1.0</td><td style=text-align:right>Female</td><td style=text-align:right>Yes</td><td style=text-align:right>Fri</td><td style=text-align:right>Dinner</td><td style=text-align:right>2</td></tr><tr><td style=text-align:right>&mldr;</td><td style=text-align:right>&mldr;</td><td style=text-align:right>&mldr;</td><td style=text-align:right>&mldr;</td><td style=text-align:right>&mldr;</td><td style=text-align:right>&mldr;</td><td style=text-align:right>&mldr;</td><td style=text-align:right>&mldr;</td></tr><tr><td style=text-align:right>319815362</td><td style=text-align:right>50.81</td><td style=text-align:right>10.0</td><td style=text-align:right>Male</td><td style=text-align:right>Yes</td><td style=text-align:right>Sat</td><td style=text-align:right>Dinner</td><td style=text-align:right>3</td></tr><tr><td style=text-align:right>319815606</td><td style=text-align:right>50.81</td><td style=text-align:right>10.0</td><td style=text-align:right>Male</td><td style=text-align:right>Yes</td><td style=text-align:right>Sat</td><td style=text-align:right>Dinner</td><td style=text-align:right>3</td></tr></tbody></table><p>319815680 rows x 7 columns</p></blockquote><p>Let's look at the line labeled &ldquo;Wall time.&rdquo; Imagine if it only took 15 milliseconds to read and sort data with 300 million rows — wouldn't that be incredible? In reality, it took about 10 seconds from the start of the cell's execution until the results were displayed. You might wonder, &ldquo;The results are displayed on the screen, so shouldn't they be properly evaluated?&rdquo; That's half true and half false.</p><p>In fact, with this approach, the evaluation of the DataFrame begins only after the <code>%%time</code> timer has stopped. In other words, because the order is <strong>timer stops → evaluation → display</strong>, the actual processing of the DataFrame is outside the measurement range of <code>%%time</code>.</p><h3 id=example-of-correct-time-measurement>Example of Correct Time Measurement</h3><p>Therefore, even in IPython Notebooks, when you want to measure execution time, make sure to explicitly call the <code>_evaluate()</code> method of DataFrames to properly evaluate them. Writing it as shown below will execute in the order of <strong>evaluation → timer stops → display</strong>. This way, the actual processing of the DataFrame falls within the measurement range of <code>%%time</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>%%</span>time
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(<span style=color:#e6db74>&#34;sample-dataset-tips10gb.csv&#34;</span>)
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>sort_values(by<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;tip&#34;</span>)
</span></span><span style=display:flex><span>df<span style=color:#f92672>.</span>_evaluate()
</span></span></code></pre></div><blockquote><pre><code>CPU times: user 3min 58s, sys: 1min 2s, total: 5min
Wall time: 11.1 s
</code></pre><table><thead><tr><th style=text-align:right></th><th style=text-align:right>total_bill</th><th style=text-align:right>tip</th><th style=text-align:right>sex</th><th style=text-align:right>smoker</th><th style=text-align:right>day</th><th style=text-align:right>time</th><th style=text-align:right>size</th></tr></thead><tbody><tr><td style=text-align:right>67</td><td style=text-align:right>3.07</td><td style=text-align:right>1.0</td><td style=text-align:right>Female</td><td style=text-align:right>Yes</td><td style=text-align:right>Sat</td><td style=text-align:right>Dinner</td><td style=text-align:right>1</td></tr><tr><td style=text-align:right>92</td><td style=text-align:right>5.75</td><td style=text-align:right>1.0</td><td style=text-align:right>Female</td><td style=text-align:right>Yes</td><td style=text-align:right>Fri</td><td style=text-align:right>Dinner</td><td style=text-align:right>2</td></tr><tr><td style=text-align:right>&mldr;</td><td style=text-align:right>&mldr;</td><td style=text-align:right>&mldr;</td><td style=text-align:right>&mldr;</td><td style=text-align:right>&mldr;</td><td style=text-align:right>&mldr;</td><td style=text-align:right>&mldr;</td><td style=text-align:right>&mldr;</td></tr><tr><td style=text-align:right>319815362</td><td style=text-align:right>50.81</td><td style=text-align:right>10.0</td><td style=text-align:right>Male</td><td style=text-align:right>Yes</td><td style=text-align:right>Sat</td><td style=text-align:right>Dinner</td><td style=text-align:right>3</td></tr><tr><td style=text-align:right>319815606</td><td style=text-align:right>50.81</td><td style=text-align:right>10.0</td><td style=text-align:right>Male</td><td style=text-align:right>Yes</td><td style=text-align:right>Sat</td><td style=text-align:right>Dinner</td><td style=text-align:right>3</td></tr></tbody></table><p>319815680 rows x 7 columns</p></blockquote><h3 id=slightly-different-solution>Slightly Different Solution</h3><p>If you write it as shown below, the order will be <strong>evaluation → display → timer stops</strong>. In this case, the process to display the DataFrame on the screen inadvertently becomes part of the time measurement. Do you notice any other differences? You might notice that the order of the DataFrame output and the timing result output is reversed.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>%%</span>time
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(<span style=color:#e6db74>&#34;sample-dataset-tips10gb.csv&#34;</span>)
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>sort_values(by<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;tip&#34;</span>)
</span></span><span style=display:flex><span>display(df)
</span></span></code></pre></div><blockquote><table><thead><tr><th style=text-align:right></th><th style=text-align:right>total_bill</th><th style=text-align:right>tip</th><th style=text-align:right>sex</th><th style=text-align:right>smoker</th><th style=text-align:right>day</th><th style=text-align:right>time</th><th style=text-align:right>size</th></tr></thead><tbody><tr><td style=text-align:right>67</td><td style=text-align:right>3.07</td><td style=text-align:right>1.0</td><td style=text-align:right>Female</td><td style=text-align:right>Yes</td><td style=text-align:right>Sat</td><td style=text-align:right>Dinner</td><td style=text-align:right>1</td></tr><tr><td style=text-align:right>92</td><td style=text-align:right>5.75</td><td style=text-align:right>1.0</td><td style=text-align:right>Female</td><td style=text-align:right>Yes</td><td style=text-align:right>Fri</td><td style=text-align:right>Dinner</td><td style=text-align:right>2</td></tr><tr><td style=text-align:right>&mldr;</td><td style=text-align:right>&mldr;</td><td style=text-align:right>&mldr;</td><td style=text-align:right>&mldr;</td><td style=text-align:right>&mldr;</td><td style=text-align:right>&mldr;</td><td style=text-align:right>&mldr;</td><td style=text-align:right>&mldr;</td></tr><tr><td style=text-align:right>319815362</td><td style=text-align:right>50.81</td><td style=text-align:right>10.0</td><td style=text-align:right>Male</td><td style=text-align:right>Yes</td><td style=text-align:right>Sat</td><td style=text-align:right>Dinner</td><td style=text-align:right>3</td></tr><tr><td style=text-align:right>319815606</td><td style=text-align:right>50.81</td><td style=text-align:right>10.0</td><td style=text-align:right>Male</td><td style=text-align:right>Yes</td><td style=text-align:right>Sat</td><td style=text-align:right>Dinner</td><td style=text-align:right>3</td></tr></tbody></table><p>319815680 rows x 7 columns</p><pre><code>CPU times: user 3min 58s, sys: 55.4 s, total: 4min 53s
Wall time: 10.6 s
</code></pre></blockquote><h2 id=wrap-up>Wrap-up</h2><p>FireDucks has the same API as pandas while adopting a lazy evaluation mechanism, so it’s important to pay attention to such subtle details when measuring processing time. However, FireDucks allows you to speed up processing while using nearly the same code as you would with pandas, making it a powerful ally for data science.</p><p>Recently, many people have shown interest in FireDucks, and we are receiving more feedback about its improved speed as well as bug reports. As the development team, we are committed to making sure FireDucks gets widely used and continues to be valuable over the long term. Please stay tuned for future updates!</p><p>May the Acceleration be with you, FireDucks Development Team</p><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/posts/2024-12-20-trace/ aria-label="Previous - How to take traces in FireDucks" class="btn btn-primary"><span class=me-1>←</span>Previous</a></li><li><a class="btn btn-primary disabled">Next<span class=ms-1>→</span></a></li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="Post issues on GitHub issues" aria-label="Post issues on GitHub issues"><a target=_blank rel=noopener href=https://github.com/fireducks-dev/fireducks aria-label="Post issues on GitHub issues"><i class="fa-brands fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Send an e-mail to us" aria-label="Send an e-mail to us"><a target=_blank rel=noopener href=mailto:contact@fireducks.jp.nec.com aria-label="Send an e-mail to us"><i class="fa-solid fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Follow us in X" aria-label="Follow us in X"><a target=_blank rel=noopener href=https://x.com/fireducksdev aria-label="Follow us in X"><i class="fa-brands fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Join us on Slack" aria-label="Join us on Slack"><a target=_blank rel=noopener href=https://join.slack.com/t/fireducks/shared_invite/zt-2j4lucmtj-IGR7AWlXO62Lu605pnBJ2w aria-label="Join us on Slack"><i class="fa-brands fa-slack"></i></a></li></ul></div><div class="col-6 col-sm-4 text-end text-xs-center order-sm-3"></div><div class="td-footer__copyright-etc col-12 col-sm-4 text-center py-2 order-sm-2"><span>&copy; 2025 FireDucks Dev Team All Rights Reserved</span></div></div></div></footer></div><script src=/js/main.min.350b703200e2632331b6ab5a6c71195d176b52e89c9b70db7c43764d40b28d92.js integrity="sha256-NQtwMgDiYyMxtqtabHEZXRdrUuicm3DbfEN2TUCyjZI=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>