<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Using Python's fast data frame library FireDucks | FireDucks</title>
<meta name=description content="pandas is a library that provides functions to support data analysis in the Python programming language. NEC Research Laboratories has developed a library called FireDucks, a faster version of pandas.
Data Preparation The analysis is performed on the data of passenger history of cabs in New York City. The source of the data is as follows:
https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page
To analyze large data sets, we downloaded and merged the &amp;ldquo;Yellow Taxi Trip Records&amp;rdquo; data from January 2022 to June 2023 from the above link."><meta property="og:title" content="Using Python's fast data frame library FireDucks"><meta property="og:description" content="pandas is a library that provides functions to support data analysis in the Python programming language. NEC Research Laboratories has developed a library called FireDucks, a faster version of pandas.
Data Preparation The analysis is performed on the data of passenger history of cabs in New York City. The source of the data is as follows:
https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page
To analyze large data sets, we downloaded and merged the &ldquo;Yellow Taxi Trip Records&rdquo; data from January 2022 to June 2023 from the above link."><meta property="og:type" content="article"><meta property="og:url" content="https://fireducks-dev.github.io/posts/nes_taxi/"><meta property="og:image" content="https://fireducks-dev.github.io/posts/nes_taxi/G-1085892316.webp"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-10-23T08:47:36+00:00"><meta property="article:modified_time" content="2023-10-23T08:47:36+00:00"><meta itemprop=name content="Using Python's fast data frame library FireDucks"><meta itemprop=description content="pandas is a library that provides functions to support data analysis in the Python programming language. NEC Research Laboratories has developed a library called FireDucks, a faster version of pandas.
Data Preparation The analysis is performed on the data of passenger history of cabs in New York City. The source of the data is as follows:
https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page
To analyze large data sets, we downloaded and merged the &ldquo;Yellow Taxi Trip Records&rdquo; data from January 2022 to June 2023 from the above link."><meta itemprop=datePublished content="2023-10-23T08:47:36+00:00"><meta itemprop=dateModified content="2023-10-23T08:47:36+00:00"><meta itemprop=wordCount content="1513"><meta itemprop=image content="https://fireducks-dev.github.io/posts/nes_taxi/G-1085892316.webp"><meta itemprop=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://fireducks-dev.github.io/posts/nes_taxi/G-1085892316.webp"><meta name=twitter:title content="Using Python's fast data frame library FireDucks"><meta name=twitter:description content="pandas is a library that provides functions to support data analysis in the Python programming language. NEC Research Laboratories has developed a library called FireDucks, a faster version of pandas.
Data Preparation The analysis is performed on the data of passenger history of cabs in New York City. The source of the data is as follows:
https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page
To analyze large data sets, we downloaded and merged the &ldquo;Yellow Taxi Trip Records&rdquo; data from January 2022 to June 2023 from the above link."><link rel=preload href=/scss/main.min.2404b01c5fb65f0b4d76f0c632723d405f2faf20557f5aeff94d8efb2e91ec8b.css as=style><link href=/scss/main.min.2404b01c5fb65f0b4d76f0c632723d405f2faf20557f5aeff94d8efb2e91ec8b.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.3.min.js integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin=anonymous></script></head><body class="td-page td-blog"><header><nav class="td-navbar navbar-dark js-navbar-scroll"><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>FireDucks</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/get-started><span>Get Started</span></a></li><li class=nav-item><a class=nav-link href=/docs/user-guide/01-intro/><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=/posts><span>Blogs</span></a></li><li class=nav-item><a class=nav-link href=/docs/benchmarks><span>Benchmarks</span></a></li><li class=nav-item><a class=nav-link href=/talks><span>Talks</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/fireducks-dev/fireducks/issues target=_blank rel=noopener><span>Report Issue</span></a></li><li class=nav-item><a class=nav-link href=/docs/about-us><span>About Us</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><ul class=dropdown-menu><li><a class=dropdown-item href=/ja/posts/nes_taxi/>Japanese</a></li></ul></div></li></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><div class="td-sidebar-nav__section nav-item dropdown d-block d-lg-none"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><ul class=dropdown-menu><li><a class=dropdown-item href=/ja/posts/nes_taxi/>Japanese</a></li></ul></div></div><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-posts-li><a href=/posts/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-posts><span>Posts</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20241206_update_polars-tpch-li><a href=/posts/20241206_update_polars-tpch/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20241206_update_polars-tpch><span>How to run polars-tpch benchmark with FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postslazy_execution_offering_part1-li><a href=/posts/lazy_execution_offering_part1/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postslazy_execution_offering_part1><span>Unveiling the Optimization Benefit of FireDucks Lazy Execution: Part #1</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsefficient_caching-li><a href=/posts/efficient_caching/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsefficient_caching><span>Unveiling the Optimization Benefit of FireDucks Lazy Execution: Part #2</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsbeginner_guide-li><a href=/posts/beginner_guide/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsbeginner_guide><span>What to do when FireDucks is slow</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20240919-workshop-li><a href=/posts/20240919-workshop/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20240919-workshop><span>Workshop at Bangalore, India</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postssourav_cse_demo_20240701-li><a href=/posts/sourav_cse_demo_20240701/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postssourav_cse_demo_20240701><span>Have you ever thought of speeding up your data analysis in pandas with a compiler?</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts2024-05-08-medium-li><a href=https://medium.com/@fireducks/introduction-to-fireducks-get-performance-beyond-pandas-with-zero-learning-cost-8694d4eab9c6 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts2024-05-08-medium><i class="fa fa-external-link"></i><span>Introduction to FireDucks: Get performance beyond pandas with zero learning cost!</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsneci4-li><a href=https://medium.com/@ashu.thakur/backtesting-trading-strategies-with-ease-an-excursion-with-fireducks-e771b701dcd5 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsneci4><i class="fa fa-external-link"></i><span>Backtesting Trading Strategies with Ease: An excursion with FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsneci3-li><a href=https://medium.com/@ashu.thakur/fireducks-diving-into-api-compatibility-with-pandas-e8f4111c2f98 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsneci3><i class="fa fa-external-link"></i><span>FireDucks: Diving into API Compatibility with Pandas</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsneci2-li><a href=https://medium.com/@ashu.thakur/choosing-your-data-champion-a-side-by-side-look-at-fireducks-and-polars-51c144fd4689 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsneci2><i class="fa fa-external-link"></i><span>Choosing Your Data Champion: A Side-by-Side Look at FireDucks and Polars</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsneci1-li><a href=https://medium.com/@ashu.thakur/boosting-data-analysis-with-fireducks-0066ad25966d target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsneci1><i class="fa fa-external-link"></i><span>Boosting Data Analysis with FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20231216-sourav-li><a href=https://qiita.com/qsourav/items/5c06426fae5f3df0244c target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20231216-sourav><i class="fa fa-external-link"></i><span>A hidden fact you must know when working with pandas</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20231211-sourav-li><a href=https://qiita.com/qsourav/items/1c1fe15faa06fce1dd33 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20231211-sourav><i class="fa fa-external-link"></i><span>Tricks to improve computational performance of JOIN operation more than 10x</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20231207-sourav-li><a href=https://qiita.com/qsourav/items/e87f25c4b307391d784a target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20231207-sourav><i class="fa fa-external-link"></i><span>FireDucks - An economical and environment-friendly high-performance solution for your complex Data Analysis</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20231206-sourav-li><a href=https://qiita.com/qsourav/items/cc4ca4c8d4668ce617bf target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20231206-sourav><i class="fa fa-external-link"></i><span>One thing you might be doing wrong in pandas!!</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsest-li><a href=/posts/est/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsest><span>Acceleration technology inside FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsimporthook-li><a href=/posts/importhook/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsimporthook><span>Import hooks: how to use FireDucks without modifying your programs</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-postsnes_taxi-li><a href=/posts/nes_taxi/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-postsnes_taxi><span class=td-sidebar-nav-active-item>Using Python's fast data frame library FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-poststtdc-li><a href=https://www.nec.com/en/global/rd/technologies/202312/index.html target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-poststtdc><i class="fa fa-external-link"></i><span>Application example: Spicy MINT at Toyota Technical Development Corporation</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#data-preparation>Data Preparation</a></li><li><a href=#actual-preprocessing>Actual preprocessing</a><ul><li><a href=#loading-data>Loading data</a></li><li><a href=#data-processing>Data processing</a></li></ul></li><li><a href=#execution-time-in-pandas>Execution time in pandas</a></li><li><a href=#execution-time-with-fireducks>Execution time with FireDucks</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><a class=td-rss-button title=RSS href=https://fireducks-dev.github.io/posts/index.xml target=_blank rel=noopener><i class="fa-solid fa-rss" aria-hidden=true></i></a><div class=td-content><h1>Using Python's fast data frame library FireDucks</h1><div class="td-byline mb-4"><time datetime=2023-10-23 class=text-muted>Monday, October 23, 2023</time></div><header class=article-meta></header><p>pandas is a library that provides functions to support data analysis in the Python programming language.
NEC Research Laboratories has developed a library called FireDucks, a faster version of pandas.</p><h2 id=data-preparation>Data Preparation</h2><p>The analysis is performed on the data of passenger history of cabs in New York City.
The source of the data is as follows:</p><blockquote><p><a href=https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page>https://www.nyc.gov/site/tlc/about/tlc-trip-record-data.page</a></p></blockquote><p>To analyze large data sets, we downloaded and merged the &ldquo;Yellow Taxi Trip Records&rdquo; data from January 2022 to June 2023 from the above link.
The data is provided in parquet format, but I converted it to csv format for testing.
A script for preparing the data is included for reference.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dir <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;xxx&#34;</span>
</span></span><span style=display:flex><span>df_list <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> year <span style=color:#f92672>in</span> [<span style=color:#ae81ff>2022</span>, <span style=color:#ae81ff>2023</span>]: <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>12</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>12</span>): <span style=color:#66d9ef>for</span> i <span style=color:#f92672>=</span> str(i<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>zfill(<span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>month <span style=color:#f92672>=</span> str(i<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>zfill(<span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>fn <span style=color:#f92672>=</span> f <span style=color:#e6db74>&#34;yellow_tripdata_</span><span style=color:#e6db74>{year}</span><span style=color:#e6db74>-</span><span style=color:#e6db74>{month}</span><span style=color:#e6db74>.parquet&#34;</span>
</span></span><span style=display:flex><span>file <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(dir, fn)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(file):
</span></span><span style=display:flex><span><span style=color:#66d9ef>continue</span>
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_parquet(fn)
</span></span><span style=display:flex><span>df_list<span style=color:#f92672>.</span>append(df)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>all_df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>concat(df_list)
</span></span><span style=display:flex><span>all_df<span style=color:#f92672>.</span>to_csv(<span style=color:#e6db74>&#34;taxi_all.csv&#34;</span>)
</span></span></code></pre></div><p>The contents of the data contains the following values (some columns are excerpts).</p><table><thead><tr><th>Column name</th><th>Data type</th><th>Description</th></tr></thead><tbody><tr><td><code>passenger_count</code></td><td>int</td><td>The number of passengers</td></tr><tr><td><code>pu_location_Id</code></td><td>string</td><td>The TLC cab zone where the cab meter started working.</td></tr><tr><td><code>do_location_Id</code></td><td>string</td><td>The TLC cab zone where the cab meter was deactivated.</td></tr><tr><td><code>tpep_dropoff_datetime</code></td><td>string</td><td>The date and time the meter was deactivated.</td></tr><tr><td><code>tpep_pickupdate_time</code></td><td>string</td><td>The date and time when the meter started to work.</td></tr><tr><td><code>trip_distance</code></td><td>double</td><td>The trip distance (in miles) reported by the cab meter.</td></tr><tr><td><code>total_amount</code></td><td>double</td><td>The total amount of money charged to the passenger, not including the cash tip.</td></tr><tr><td><code>extra</code></td><td>double</td><td>Other surcharges and additional charges. Currently, this includes only the $0.50 and $1 rush hour and nighttime fares.</td></tr><tr><td><code>fare_amount</code></td><td>double</td><td>Time-and-distance combined fare calculated by the meter.</td></tr></tbody></table><h2 id=actual-preprocessing>Actual preprocessing</h2><p>A series of preprocessing calculations, such as type conversion, column addition, and outlier deletion, which are often used in data analysis, are performed on the prepared data.</p><p>First, prepare a wrapper for speed measurement.
<code>_evaluate()</code> is described later.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> time <span style=color:#f92672>import</span> time
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> functools <span style=color:#f92672>import</span> wraps
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>timer</span>(func):
</span></span><span style=display:flex><span><span style=color:#a6e22e>@wraps</span>(func)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>wp</span>(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kargs):
</span></span><span style=display:flex><span>t <span style=color:#f92672>=</span> time()
</span></span><span style=display:flex><span>ret <span style=color:#f92672>=</span> func(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kargs)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>func<span style=color:#f92672>.</span>__name__<span style=color:#e6db74>}</span><span style=color:#e6db74> : </span><span style=color:#e6db74>{</span>(time() <span style=color:#f92672>-</span> t)<span style=color:#e6db74>:</span><span style=color:#e6db74>.5g</span><span style=color:#e6db74>}</span><span style=color:#e6db74> [sec]&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> ret
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> wp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>evaluate</span>(df):
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> hasattr(df, <span style=color:#e6db74>&#34;_evaluate&#34;</span>):
</span></span><span style=display:flex><span>df<span style=color:#f92672>.</span>_evaluate()
</span></span></code></pre></div><h3 id=loading-data>Loading data</h3><p>First, read the data.
Import pandas and then use <code>read_csv</code> to read the data.
Define a function, and call it later to measure the data.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a6e22e>@timer</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>file_read</span>(fn, args<span style=color:#f92672>=</span>{}):
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(fn, <span style=color:#f92672>**</span>args)
</span></span><span style=display:flex><span>evaluate(df)
</span></span><span style=display:flex><span>print(df<span style=color:#f92672>.</span>shape)
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> df
</span></span></code></pre></div><h3 id=data-processing>Data processing</h3><p>Remove data with missing values.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a6e22e>@timer</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>drop_na</span>(df):
</span></span><span style=display:flex><span>df<span style=color:#f92672>.</span>dropna(how<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;all&#34;</span>, inplace<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>evaluate(df)
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> df
</span></span></code></pre></div><p>The date and time of boarding and alighting are read as strings, so they should be converted to dates.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a6e22e>@timer</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>txt_to_date</span>(df, low):
</span></span><span style=display:flex><span>df[low] <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>to_datetime(df[low])
</span></span><span style=display:flex><span>evaluate(df)
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> df
</span></span></code></pre></div><p>Let&rsquo;s look at the distribution grouped by the number of boardings (print is not included in the performance evaluation, so it is omitted).
We see that there are data with zero riders, so we remove them.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># At least one person on the train</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@timer</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>check_passenger_c</span>(df):
</span></span><span style=display:flex><span>df_ <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>groupby(<span style=color:#e6db74>&#34;passenger_count&#34;</span>)<span style=color:#f92672>.</span>size()
</span></span><span style=display:flex><span>evaluate(df_)
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> df[df[<span style=color:#e6db74>&#34;passenger_count&#34;</span>] <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>evaluate(df)
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> df
</span></span></code></pre></div><p>Extract the year, month, day, and hour information from the ride date data and add columns.
The distribution of the year and month of the ride contains incorrect values, so we remove them.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># correct ride year/month</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@timer</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>check_pu_date</span>(df):
</span></span><span style=display:flex><span>df[<span style=color:#e6db74>&#39;year&#39;</span>] <span style=color:#f92672>=</span> df[<span style=color:#e6db74>&#39;tpep_pickup_datetime&#39;</span>]<span style=color:#f92672>.</span>dt<span style=color:#f92672>.</span>year
</span></span><span style=display:flex><span>df[<span style=color:#e6db74>&#39;month&#39;</span>] <span style=color:#f92672>=</span> df[<span style=color:#e6db74>&#39;tpep_pickup_datetime&#39;</span>]<span style=color:#f92672>.</span>dt<span style=color:#f92672>.</span>month
</span></span><span style=display:flex><span>df[<span style=color:#e6db74>&#39;date&#39;</span>] <span style=color:#f92672>=</span> df[<span style=color:#e6db74>&#39;tpep_pickup_datetime&#39;</span>]<span style=color:#f92672>.</span>dt<span style=color:#f92672>.</span>day
</span></span><span style=display:flex><span>df[<span style=color:#e6db74>&#39;hour&#39;</span>] <span style=color:#f92672>=</span> df[<span style=color:#e6db74>&#39;tpep_pickup_datetime&#39;</span>]<span style=color:#f92672>.</span>dt<span style=color:#f92672>.</span>hour
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>df_ <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>groupby(<span style=color:#e6db74>&#34;year&#34;</span>)<span style=color:#f92672>.</span>size()
</span></span><span style=display:flex><span>evaluate(df_)
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> df[(df[<span style=color:#e6db74>&#39;year&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>2022</span>) <span style=color:#f92672>|</span> (df[<span style=color:#e6db74>&#39;year&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>2023</span>)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>df_ <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>groupby(<span style=color:#e6db74>&#34;month&#34;</span>)<span style=color:#f92672>.</span>size()
</span></span><span style=display:flex><span>evaluate(df_)
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> df[(df[<span style=color:#e6db74>&#39;month&#39;</span>] <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>&amp;</span> df[<span style=color:#e6db74>&#39;month&#39;</span>] <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>12</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>df_ <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>groupby([<span style=color:#e6db74>&#34;year&#34;</span>, <span style=color:#e6db74>&#34;month&#34;</span>])<span style=color:#f92672>.</span>size()
</span></span><span style=display:flex><span>evaluate(df_)
</span></span><span style=display:flex><span>evaluate(df)
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> df
</span></span></code></pre></div><p>Convert the difference between the disembarkation time and the ride time to minutes and add a column.
Remove non-positive or too long ride times.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># realistic ride time in minutes</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@timer</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>check_ride_time</span>(df):
</span></span><span style=display:flex><span>df[<span style=color:#e6db74>&#34;ride_time&#34;</span>] <span style=color:#f92672>=</span> (df[<span style=color:#e6db74>&#34;tpep_dropoff_datetime&#34;</span>] <span style=color:#f92672>-</span> df[<span style=color:#e6db74>&#34;tpep_pickup_datetime&#34;</span>])<span style=color:#f92672>.</span>dt<span style=color:#f92672>.</span>seconds <span style=color:#f92672>/</span> <span style=color:#ae81ff>60</span>
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> df[(df[<span style=color:#e6db74>&#34;ride_time&#34;</span>] <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>&amp;</span> (df[<span style=color:#e6db74>&#34;ride_time&#34;</span>] <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>180</span>)]
</span></span><span style=display:flex><span>evaluate(df)
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> df
</span></span></code></pre></div><p>Remove non-negative or too large values for ride distance and fare.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># realistic distances</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@timer</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>check_trip_distance</span>(df):
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> df[(df[<span style=color:#e6db74>&#34;trip_distance&#34;</span>] <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>&amp;</span> (df[<span style=color:#e6db74>&#34;trip_distance&#34;</span>] <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>250</span>)]
</span></span><span style=display:flex><span>evaluate(df)
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> df
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Realistic fares</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@timer</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>check_total_amount</span>(df):
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> df[(df[<span style=color:#e6db74>&#34;total_amount&#34;</span>] <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>&amp;</span> (df[<span style=color:#e6db74>&#34;total_amount&#34;</span>] <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>1000</span>)]
</span></span><span style=display:flex><span>evaluate(df)
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> df
</span></span></code></pre></div><p>Calculate the latitude and longitude from the IDs of the boarding and alighting points.
The relationship between the ID and the point can be checked as follows:</p><blockquote><p><a href=https://d37ci6vzurychx.cloudfront.net/misc/taxi+_zone_lookup.csv>https://d37ci6vzurychx.cloudfront.net/misc/taxi+_zone_lookup.csv</a></p></blockquote><p>The columns are added by merging the conversion table created based on the latitude and longitude calculated from:</p><blockquote><p><a href=https://d37ci6vzurychx.cloudfront.net/misc/taxi_zones.zip>https://d37ci6vzurychx.cloudfront.net/misc/taxi_zones.zip</a></p></blockquote><p>Remove data outside New York City from the latitude and longitude information.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Find latitude and longitude from IDs</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@timer</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>add_coordinate</span>(df, ID_df):
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>merge(ID_df<span style=color:#f92672>.</span>rename(columns<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;longitude&#34;</span>: <span style=color:#e6db74>&#34;start_lon&#34;</span>, <span style=color:#e6db74>&#34;latitude&#34;</span>: <span style=color:#e6db74>&#34;start_lat&#34;</span>}),
</span></span><span style=display:flex><span>left_on<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;PULocationID&#34;</span>, right_on<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;LocationID&#34;</span>, how<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;left&#34;</span>)<span style=color:#f92672>.</span>drop(<span style=color:#e6db74>&#34;LocationID&#34;</span>, axis<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>merge(ID_df<span style=color:#f92672>.</span>rename(columns<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;longitude&#34;</span>: <span style=color:#e6db74>&#34;end_lon&#34;</span>, <span style=color:#e6db74>&#34;latitude&#34;</span>: <span style=color:#e6db74>&#34;end_lat&#34;</span>}),
</span></span><span style=display:flex><span>left_on<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;DOLocationID&#34;</span>, right_on<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;LocationID&#34;</span>, how<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;left&#34;</span>)<span style=color:#f92672>.</span>drop(<span style=color:#e6db74>&#34;LocationID&#34;</span>, axis<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>evaluate(df)
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> df
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Check if it is in NY</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@timer</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>in_NY</span>(df):
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> df[(df[<span style=color:#e6db74>&#34;start_lon&#34;</span>] <span style=color:#f92672>&lt;=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>71.47</span>) <span style=color:#f92672>&amp;</span> (df[<span style=color:#e6db74>&#34;start_lon&#34;</span>] <span style=color:#f92672>&gt;=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>79.45</span>)]
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> df[(df[<span style=color:#e6db74>&#34;start_lat&#34;</span>] <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>40.29</span>) <span style=color:#f92672>&amp;</span> (df[<span style=color:#e6db74>&#34;start_lat&#34;</span>] <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>45</span>)]
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> df[(df[<span style=color:#e6db74>&#34;end_lon&#34;</span>] <span style=color:#f92672>&lt;=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>71.47</span>) <span style=color:#f92672>&amp;</span> (df[<span style=color:#e6db74>&#34;end_lon&#34;</span>] <span style=color:#f92672>&gt;=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>79.45</span>)]
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> df[(df[<span style=color:#e6db74>&#34;end_lat&#34;</span>] <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>40.29</span>) <span style=color:#f92672>&amp;</span> (df[<span style=color:#e6db74>&#34;end_lat&#34;</span>] <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>45</span>)]
</span></span><span style=display:flex><span>evaluate(df)
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> df
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>check_in_NY</span>(df, ID_df):
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> add_coordinate(df, ID_df)
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> in_NY(df)
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> df
</span></span></code></pre></div><p>As described above, a series of processes are prepared to read data, perform type conversion, add columns, and remove outlier values.</p><ol><li>Read the file</li><li>Convert date data from string to date data</li><li>Preprocessing</li><li>Remove missing values</li><li>Check the number of passengers</li><li>Check distribution by groupby</li><li>Select at least 1 passenger</li><li>Check the time of boarding</li><li>Tet the year, month, date and time from the date data and add a column</li><li>Group by year and check -> Select only the relevant year</li><li>Group by month and check -> select only Jan-Dec</li><li>Group by year and month and check the distribution</li><li>Check the boarding time</li><li>Take the difference between the time of disembarkation and the time of embarkation, convert to minutes, and add a column (<code>dt.total_second</code> is not supported by FireDucks)</li><li>Select realistic ride time data</li><li>Check the ride distance</li><li>Select realistic distance data</li><li>Check fare</li><li>Select realistic fare data</li><li>Select NY City data</li><li>Merge the passenger ID with the latitude and longitude table</li><li>Select the data where the longitude and latitude of the boarding and alighting is in NY city</li></ol><h2 id=execution-time-in-pandas>Execution time in pandas</h2><p>First, let&rsquo;s check the execution time on pandas.
A 24-core Xeon server (Intel(R) Xeon(R) Gold 6226 CPU x 2, 256GB main memory) was used for the measurement.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>data_path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;data_sets&#34;</span>
</span></span><span style=display:flex><span>fn <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(data_path, <span style=color:#e6db74>&#34;taxi_all.csv&#34;</span>)
</span></span><span style=display:flex><span>ID_file <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(data_path, <span style=color:#e6db74>&#34;ID_to_coordinate.csv&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>need_cols <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;tpep_pickup_datetime&#39;</span>,<span style=color:#e6db74>&#39;tpep_dropoff_datetime&#39;</span>, <span style=color:#e6db74>&#39;passenger_count&#39;</span>, <span style=color:#e6db74>&#39;trip_distance&#39;</span>,
</span></span><span style=display:flex><span><span style=color:#e6db74>&#39;PULocationID&#39;</span>, <span style=color:#e6db74>&#39;DOLocationID&#39;</span>, <span style=color:#e6db74>&#39;total_amount&#39;</span>, <span style=color:#e6db74>&#39;improvement_surcharge&#39;</span>, <span style=color:#e6db74>&#39;extra&#39;</span>, <span style=color:#e6db74>&#39;fare_amount&#39;</span>, <span style=color:#e6db74>&#39;RatecodeID&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@timer</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>Preprocessing</span>():
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> file_read(fn, {<span style=color:#e6db74>&#34;usecols&#34;</span>: need_cols})
</span></span><span style=display:flex><span>ID_df <span style=color:#f92672>=</span> file_read(ID_file)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> txt_to_date(df, <span style=color:#e6db74>&#34;tpep_pickup_datetime&#34;</span>)
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> txt_to_date(df, <span style=color:#e6db74>&#34;tpep_dropoff_datetime&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> drop_na(df)
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> check_passenger_c(df)
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> check_pu_date(df)
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> check_ride_time(df)
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> check_trip_distance(df)
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> check_total_amount(df)
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> check_in_NY(df, ID_df)
</span></span><span style=display:flex><span>evaluate(df)
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> df
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> Preprocessing()
</span></span></code></pre></div><p>Now, the execution time in pandas is as shown in the table below.
The two <code>file_read</code> files are due to reading the taxi data as well as the location data for merging, and the <code>txt_to_date</code> file is due to converting the ride time and the drop-off time.
The execution time shows that it took more than one minute to read the file.
In addition, <code>check_pu_date</code> and <code>add_coordinate</code>, which include adding columns and merge processing, take more than 30 seconds, and the implemented preprocessing takes 186 seconds to complete.</p><h2 id=execution-time-with-fireducks>Execution time with FireDucks</h2><p>Measure the execution time when using FireDucks with the imported library replaced by pandas.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>pip install fireducks
</span></span></code></pre></div><p>The above scripts for pandas preprocessing can be used as-is by importing FireDucks, since FireDucks is compatible with pandas.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> fireducks.pandas <span style=color:#66d9ef>as</span> pd
</span></span></code></pre></div><p>Note that FireDucks does not immediately execute methods when they are called.
Therefore, it is necessary to run <code>_evaluate()</code> to measure the execution time of each method.</p><p>The following table compares the execution time of FireDucks with that of pandas after importing FireDucks and performing the same preprocessing calculations.</p><table><thead><tr><th style=text-align:left>Function</th><th style=text-align:right>pandas [sec]</th><th style=text-align:right>FireDucks [sec]</th><th style=text-align:right>Speed-up ratio</th></tr></thead><tbody><tr><td style=text-align:left><code>file_read</code></td><td style=text-align:right>72.19</td><td style=text-align:right>3.52</td><td style=text-align:right>20.49</td></tr><tr><td style=text-align:left><code>file_read</code></td><td style=text-align:right>0.003</td><td style=text-align:right>0.01</td><td style=text-align:right>0.38</td></tr><tr><td style=text-align:left><code>txt_to_date</code></td><td style=text-align:right>9.07</td><td style=text-align:right>19.10</td><td style=text-align:right>0.48</td></tr><tr><td style=text-align:left><code>txt_to_date</code></td><td style=text-align:right>8.57</td><td style=text-align:right>20.57</td><td style=text-align:right>0.42</td></tr><tr><td style=text-align:left><code>drop_na</code></td><td style=text-align:right>3.13</td><td style=text-align:right>0.70</td><td style=text-align:right>4.47</td></tr><tr><td style=text-align:left><code>check_passenger_c</code></td><td style=text-align:right>3.21</td><td style=text-align:right>1.80</td><td style=text-align:right>1.79</td></tr><tr><td style=text-align:left><code>check_pu_date</code></td><td style=text-align:right>27.37</td><td style=text-align:right>0.99</td><td style=text-align:right>27.64</td></tr><tr><td style=text-align:left><code>check_ride_time</code></td><td style=text-align:right>7.02</td><td style=text-align:right>2.00</td><td style=text-align:right>3.51</td></tr><tr><td style=text-align:left><code>check_trip_distance</code></td><td style=text-align:right>3.24</td><td style=text-align:right>0.91</td><td style=text-align:right>3.55</td></tr><tr><td style=text-align:left><code>check_total_amount</code></td><td style=text-align:right>3.11</td><td style=text-align:right>0.93</td><td style=text-align:right>3.59</td></tr><tr><td style=text-align:left><code>check_total_amount</code></td><td style=text-align:right>3.11</td><td style=text-align:right>0.93</td><td style=text-align:right>3.59</td></tr><tr><td style=text-align:left><code>in_NY</code></td><td style=text-align:right>20.75</td><td style=text-align:right>2.71</td><td style=text-align:right>7.65</td></tr><tr><td style=text-align:left><code>Preprocessing</code></td><td style=text-align:right>186.02</td><td style=text-align:right>54.92</td><td style=text-align:right>3.39</td></tr></tbody></table><p>The <code>file_read</code> process took more than 70 seconds to complete in pandas, but it took about 3.5 seconds, which is more than 20 times faster.
Other time-consuming processes (<code>check_pu_date</code>, <code>add_coordinate</code>) were also significantly reduced.</p><p>The computation time for <code>txt_to_date</code> was increased by using FireDucks.
This is because the <code>to_datetime()</code> function is not supported by FireDucks at the time of writing.
However, even when a function like <code>to_datetime()</code> is called that does not support acceleration, FireDucks does not return an error because it performs the calculation by calling a pandas function.</p><p>The total computation time for the preprocessing calculations in this article was 55 seconds with FireDucks, compared to 186 seconds with pandas, which is about 3.4 times faster.
Of the 55 seconds, about 40 seconds was for processing that had not yet been accelerated, and further acceleration is expected in the future.</p><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/posts/ttdc/ aria-label="Previous - Application example: Spicy MINT at Toyota Technical Development Corporation" class="btn btn-primary"><span class=me-1>←</span>Previous</a></li><li><a href=/posts/importhook/ aria-label="Next - Import hooks: how to use FireDucks without modifying your programs" class="btn btn-primary">Next<span class=ms-1>→</span></a></li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="Post issues on GitHub issues" aria-label="Post issues on GitHub issues"><a target=_blank rel=noopener href=https://github.com/fireducks-dev/fireducks aria-label="Post issues on GitHub issues"><i class="fa-brands fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Send an e-mail to us" aria-label="Send an e-mail to us"><a target=_blank rel=noopener href=mailto:contact@fireducks.jp.nec.com aria-label="Send an e-mail to us"><i class="fa-solid fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Follow us in X" aria-label="Follow us in X"><a target=_blank rel=noopener href=https://x.com/fireducksdev aria-label="Follow us in X"><i class="fa-brands fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Join us on Slack" aria-label="Join us on Slack"><a target=_blank rel=noopener href=https://join.slack.com/t/fireducks/shared_invite/zt-2j4lucmtj-IGR7AWlXO62Lu605pnBJ2w aria-label="Join us on Slack"><i class="fa-brands fa-slack"></i></a></li></ul></div><div class="col-6 col-sm-4 text-end text-xs-center order-sm-3"></div><div class="td-footer__copyright-etc col-12 col-sm-4 text-center py-2 order-sm-2"><span>&copy; 2024 FireDucks Dev Team All Rights Reserved</span></div></div></div></footer></div><script src=/js/main.min.350b703200e2632331b6ab5a6c71195d176b52e89c9b70db7c43764d40b28d92.js integrity="sha256-NQtwMgDiYyMxtqtabHEZXRdrUuicm3DbfEN2TUCyjZI=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>