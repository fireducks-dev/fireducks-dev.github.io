<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Ensuring compatibility with pandas in the GPU version of FireDucks | FireDucks</title>
<meta name=description content="We are currently developing a GPU version of FireDucks.
FireDucks is built with an architecture that translates programs into an intermediate representation at runtime, optimizes them in this intermediate representation, and then compiles and executes the intermediate representation for the backend. The currently released CPU version of FireDucks has a backend for CPUs. In the development of the GPU version, the backend is changed to a GPU. This allows us to use the translation to and optimization of the intermediate representation developed for the CPU version as is."><meta property="og:title" content="Ensuring compatibility with pandas in the GPU version of FireDucks"><meta property="og:description" content="We are currently developing a GPU version of FireDucks.
FireDucks is built with an architecture that translates programs into an intermediate representation at runtime, optimizes them in this intermediate representation, and then compiles and executes the intermediate representation for the backend. The currently released CPU version of FireDucks has a backend for CPUs. In the development of the GPU version, the backend is changed to a GPU. This allows us to use the translation to and optimization of the intermediate representation developed for the CPU version as is."><meta property="og:type" content="article"><meta property="og:url" content="https://fireducks-dev.github.io/posts/2024-12-19-araki-en/"><meta property="og:image" content="https://fireducks-dev.github.io/images/fireducks_1200x630.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-19T00:00:00+00:00"><meta property="article:modified_time" content="2024-12-19T00:00:00+00:00"><meta itemprop=name content="Ensuring compatibility with pandas in the GPU version of FireDucks"><meta itemprop=description content="We are currently developing a GPU version of FireDucks.
FireDucks is built with an architecture that translates programs into an intermediate representation at runtime, optimizes them in this intermediate representation, and then compiles and executes the intermediate representation for the backend. The currently released CPU version of FireDucks has a backend for CPUs. In the development of the GPU version, the backend is changed to a GPU. This allows us to use the translation to and optimization of the intermediate representation developed for the CPU version as is."><meta itemprop=datePublished content="2024-12-19T00:00:00+00:00"><meta itemprop=dateModified content="2024-12-19T00:00:00+00:00"><meta itemprop=wordCount content="1080"><meta itemprop=image content="https://fireducks-dev.github.io/images/fireducks_1200x630.png"><meta itemprop=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://fireducks-dev.github.io/images/fireducks_1200x630.png"><meta name=twitter:title content="Ensuring compatibility with pandas in the GPU version of FireDucks"><meta name=twitter:description content="We are currently developing a GPU version of FireDucks.
FireDucks is built with an architecture that translates programs into an intermediate representation at runtime, optimizes them in this intermediate representation, and then compiles and executes the intermediate representation for the backend. The currently released CPU version of FireDucks has a backend for CPUs. In the development of the GPU version, the backend is changed to a GPU. This allows us to use the translation to and optimization of the intermediate representation developed for the CPU version as is."><link rel=preload href=/scss/main.min.2404b01c5fb65f0b4d76f0c632723d405f2faf20557f5aeff94d8efb2e91ec8b.css as=style><link href=/scss/main.min.2404b01c5fb65f0b4d76f0c632723d405f2faf20557f5aeff94d8efb2e91ec8b.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.3.min.js integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin=anonymous></script></head><body class="td-page td-blog"><header><nav class="td-navbar navbar-dark js-navbar-scroll"><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>FireDucks</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/docs/get-started><span>Get Started</span></a></li><li class=nav-item><a class=nav-link href=/docs/user-guide/01-intro/><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=/posts><span>Blogs</span></a></li><li class=nav-item><a class=nav-link href=/docs/benchmarks><span>Benchmarks</span></a></li><li class=nav-item><a class=nav-link href=/talks><span>Talks</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/fireducks-dev/fireducks/issues target=_blank rel=noopener><span>Report Issue</span></a></li><li class=nav-item><a class=nav-link href=/docs/about-us><span>About Us</span></a></li><li class="nav-item dropdown d-none d-lg-block"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><ul class=dropdown-menu><li><a class=dropdown-item href=/ja/>Japanese</a></li></ul></div></li></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><div class="td-sidebar-nav__section nav-item dropdown d-block d-lg-none"><div class=dropdown><a class="nav-link dropdown-toggle" href=# role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><ul class=dropdown-menu><li><a class=dropdown-item href=/ja/>Japanese</a></li></ul></div></div><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-posts-li><a href=/posts/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-posts><span>Posts</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-posts2024-12-19-araki-en-li><a href=/posts/2024-12-19-araki-en/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-posts2024-12-19-araki-en><span class=td-sidebar-nav-active-item>Ensuring compatibility with pandas in the GPU version of FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postscudf_vs_fireducks-li><a href=/posts/cudf_vs_fireducks/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postscudf_vs_fireducks><span>Exploring performance benefits of FireDucks over cuDF</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20241217_liveness_analysis-li><a href=/posts/20241217_liveness_analysis/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20241217_liveness_analysis><span>Cache or Eliminate? How FireDucks increase opportunity of optimization</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20241206_update_polars-tpch-li><a href=/posts/20241206_update_polars-tpch/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20241206_update_polars-tpch><span>How to run polars-tpch benchmark with FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postslazy_execution_offering_part1-li><a href=/posts/lazy_execution_offering_part1/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postslazy_execution_offering_part1><span>Unveiling the Optimization Benefit of FireDucks Lazy Execution: Part #1</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsefficient_caching-li><a href=/posts/efficient_caching/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsefficient_caching><span>Unveiling the Optimization Benefit of FireDucks Lazy Execution: Part #2</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsbeginner_guide-li><a href=/posts/beginner_guide/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsbeginner_guide><span>What to do when FireDucks is slow</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20240919-workshop-li><a href=/posts/20240919-workshop/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20240919-workshop><span>Workshop at Bangalore, India</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postssourav_cse_demo_20240701-li><a href=/posts/sourav_cse_demo_20240701/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postssourav_cse_demo_20240701><span>Have you ever thought of speeding up your data analysis in pandas with a compiler?</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts2024-05-08-medium-li><a href=https://medium.com/@fireducks/introduction-to-fireducks-get-performance-beyond-pandas-with-zero-learning-cost-8694d4eab9c6 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts2024-05-08-medium><i class="fa fa-external-link"></i><span>Introduction to FireDucks: Get performance beyond pandas with zero learning cost!</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsneci4-li><a href=https://medium.com/@ashu.thakur/backtesting-trading-strategies-with-ease-an-excursion-with-fireducks-e771b701dcd5 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsneci4><i class="fa fa-external-link"></i><span>Backtesting Trading Strategies with Ease: An excursion with FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsneci3-li><a href=https://medium.com/@ashu.thakur/fireducks-diving-into-api-compatibility-with-pandas-e8f4111c2f98 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsneci3><i class="fa fa-external-link"></i><span>FireDucks: Diving into API Compatibility with Pandas</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsneci2-li><a href=https://medium.com/@ashu.thakur/choosing-your-data-champion-a-side-by-side-look-at-fireducks-and-polars-51c144fd4689 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsneci2><i class="fa fa-external-link"></i><span>Choosing Your Data Champion: A Side-by-Side Look at FireDucks and Polars</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsneci1-li><a href=https://medium.com/@ashu.thakur/boosting-data-analysis-with-fireducks-0066ad25966d target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsneci1><i class="fa fa-external-link"></i><span>Boosting Data Analysis with FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20231216-sourav-li><a href=https://qiita.com/qsourav/items/5c06426fae5f3df0244c target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20231216-sourav><i class="fa fa-external-link"></i><span>A hidden fact you must know when working with pandas</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20231211-sourav-li><a href=https://qiita.com/qsourav/items/1c1fe15faa06fce1dd33 target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20231211-sourav><i class="fa fa-external-link"></i><span>Tricks to improve computational performance of JOIN operation more than 10x</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20231207-sourav-li><a href=https://qiita.com/qsourav/items/e87f25c4b307391d784a target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20231207-sourav><i class="fa fa-external-link"></i><span>FireDucks - An economical and environment-friendly high-performance solution for your complex Data Analysis</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-posts20231206-sourav-li><a href=https://qiita.com/qsourav/items/cc4ca4c8d4668ce617bf target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-posts20231206-sourav><i class="fa fa-external-link"></i><span>One thing you might be doing wrong in pandas!!</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsest-li><a href=/posts/est/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsest><span>Acceleration technology inside FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsimporthook-li><a href=/posts/importhook/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsimporthook><span>Import hooks: how to use FireDucks without modifying your programs</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-postsnes_taxi-li><a href=/posts/nes_taxi/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-postsnes_taxi><span>Using Python's fast data frame library FireDucks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-poststtdc-li><a href=https://www.nec.com/en/global/rd/technologies/202312/index.html target=_blank rel=noopener class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-poststtdc><i class="fa fa-external-link"></i><span>Application example: Spicy MINT at Toyota Technical Development Corporation</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#different-result-types>Different result types</a></li><li><a href=#missing-values-are-handled-differently-in-calculations>Missing values are handled differently in calculations</a></li><li><a href=#the-results-of-merge-are-different>The results of merge are different</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role=main><a class=td-rss-button title=RSS href=https://fireducks-dev.github.io/posts/index.xml target=_blank rel=noopener><i class="fa-solid fa-rss" aria-hidden=true></i></a><div class=td-content><h1>Ensuring compatibility with pandas in the GPU version of FireDucks</h1><div class="td-byline mb-4"><time datetime=2024-12-19 class=text-muted>Thursday, December 19, 2024</time></div><header class=article-meta></header><p>We are currently developing a GPU version of FireDucks.</p><p>FireDucks is built with an architecture that translates programs into an intermediate representation at runtime, optimizes them in this intermediate representation, and then compiles and executes the intermediate representation for the backend. The currently released CPU version of FireDucks has a backend for CPUs. In the development of the GPU version, the backend is changed to a GPU. This allows us to use the translation to and optimization of the intermediate representation developed for the CPU version as is.</p><p>In developing the GPU backend, we are making use of NVIDIA&rsquo;s cuDF library. Our intermediate representation is roughly compatible with the pandas API, and cuDF provides similar API to pandas, so at first glance the backend development seems straightforward. However, the functions provided by cuDF are slightly different from those provided by pandas, so some ingenuity is required to maintain compatibility with pandas.</p><p>In this blog post, I would like to briefly introduce some of the issues that need to be addressed in order to maintain compatibility with pandas.</p><h2 id=different-result-types>Different result types</h2><p>When working with dates in pandas, if you convert them to the datetime64 type, you can use the dt accessor to extract the year, month, and day.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame({<span style=color:#e6db74>&#34;a&#34;</span>: [<span style=color:#e6db74>&#34;2017-11-01 12:24:00&#34;</span>]})
</span></span><span style=display:flex><span>dfa <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>to_datetime(df[<span style=color:#e6db74>&#34;a&#34;</span>])
</span></span><span style=display:flex><span>print(dfa<span style=color:#f92672>.</span>dt<span style=color:#f92672>.</span>year)
</span></span></code></pre></div><p>will return <code>2017</code>. By the way, what is the type of this value?
If you do <code>print(dfa.dt.year.dtype)</code>, pandas returns <code>int32</code> and cuDf returns <code>int16</code>. This difference seems to be intentional, in order to reduce the amount of memory used by the GPU.</p><p>The year is unlikely to exceed 16 bits, and there doesn&rsquo;t seem to be a major problem, but if you use it for calculations, there is a possibility that the result will change due to overflow. For example, if you try to calculate the number of hours from year 0, and use <code>dfa.dt.year * 365 * 24</code>, you will get a different result because of the overflow in int16.</p><p>This is not limited to this example, but in cuDF, the type of the result is often slightly different. In FireDucks, we convert the result to the same type to maintain compatibility with pandas.</p><h2 id=missing-values-are-handled-differently-in-calculations>Missing values are handled differently in calculations</h2><p>In pandas, missing values (what we call NULL in RDB) are basically expressed as NaN. On the other hand, in cuDF, missing values are treated as a special value (NA). Therefore, the calculation results may be different.</p><p>For example,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>Series([<span style=color:#ae81ff>1.0</span>, <span style=color:#ae81ff>3.0</span>, np<span style=color:#f92672>.</span>nan])
</span></span><span style=display:flex><span>mask <span style=color:#f92672>=</span> df <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>2.0</span>
</span></span><span style=display:flex><span>print (mask)
</span></span></code></pre></div><p>will print</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ae81ff>0</span>     <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>    <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>    <span style=color:#66d9ef>False</span>
</span></span></code></pre></div><p>in the case of pandas. False is entered in the missing value position. This is because it is compared with np.nan.</p><p>On the other hand, in the case of cuDF,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ae81ff>0</span>     <span style=color:#66d9ef>True</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>    <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>     <span style=color:#f92672>&lt;</span>NA<span style=color:#f92672>&gt;</span>
</span></span></code></pre></div><p>is printed. The result of the operation is also a missing value (NA). In RDB, operations with NULL always result return NULL, so the results are consistent with RDB, but not with pandas. I think this is also an intentional feature of cuDF.</p><p>In pandas, a special value (pd.NA) can be used experimentally as a missing value. When this is used, the results are the same as in cuDF and RDB, but otherwise the results are different. In FireDucks, the results are adjusted so that the handling of missing values is the same as pandas.</p><h2 id=the-results-of-merge-are-different>The results of merge are different</h2><p>Pandas&rsquo; merge has a complex specification, and cuDF does not necessarily follow that specification. This may change in the future, but for now there are differences, such as the following.</p><p>In pandas merge, you can use <code>left_on</code> and <code>right_on</code> to specify the columns to be used for merging. Normally, you specify the column names here, but if the index has a name, you can also specify the index name. You can also specify the index by specifying <code>left_index=True</code> or <code>right_index=True</code>. Let&rsquo;s try merging using these functions.</p><p>First, create a DataFrame for merging. The left dataframe is created as:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>idx1 <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>Index([<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>3</span>,<span style=color:#ae81ff>4</span>],name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;p&#34;</span>)
</span></span><span style=display:flex><span>df1 <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame([[<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>2</span>],[<span style=color:#ae81ff>3</span>,<span style=color:#ae81ff>4</span>],[<span style=color:#ae81ff>5</span>,<span style=color:#ae81ff>6</span>],[<span style=color:#ae81ff>7</span>,<span style=color:#ae81ff>8</span>]], columns<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;a&#34;</span>,<span style=color:#e6db74>&#34;b&#34;</span>], index<span style=color:#f92672>=</span>idx1)
</span></span></code></pre></div><p>The result is:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>    a  b
</span></span><span style=display:flex><span> p
</span></span><span style=display:flex><span> <span style=color:#ae81ff>1</span>  <span style=color:#ae81ff>1</span>  <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span> <span style=color:#ae81ff>2</span>  <span style=color:#ae81ff>3</span>  <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span> <span style=color:#ae81ff>3</span>  <span style=color:#ae81ff>5</span>  <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span> <span style=color:#ae81ff>4</span>  <span style=color:#ae81ff>7</span>  <span style=color:#ae81ff>8</span>
</span></span></code></pre></div><p>The right dataframe is created as:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>idx2 <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>Index([<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>5</span>,<span style=color:#ae81ff>6</span>],name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;q&#34;</span>)
</span></span><span style=display:flex><span>df2 <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame([[<span style=color:#ae81ff>3</span>,<span style=color:#ae81ff>4</span>],[<span style=color:#ae81ff>5</span>,<span style=color:#ae81ff>6</span>],[<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>2</span>],[<span style=color:#ae81ff>3</span>,<span style=color:#ae81ff>4</span>]], columns<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;c&#34;</span>,<span style=color:#e6db74>&#34;d&#34;</span>], index<span style=color:#f92672>=</span>idx2)
</span></span></code></pre></div><p>The result is:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>   c  d
</span></span><span style=display:flex><span>q
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>  <span style=color:#ae81ff>3</span>  <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>  <span style=color:#ae81ff>5</span>  <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>5</span>  <span style=color:#ae81ff>1</span>  <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>6</span>  <span style=color:#ae81ff>3</span>  <span style=color:#ae81ff>4</span>
</span></span></code></pre></div><p>Now let&rsquo;s try merging these. On the left, we specify the index column by name with <code>left_on=[“p”]</code>, and on the right, we specify that we want to use the index column with <code>right_index=True</code>. We specify “outer” for how to perform an outer join, as in an RDB.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df1<span style=color:#f92672>.</span>merge(df2, left_on<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#34;p&#34;</span>], right_index<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, how<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;outer&#34;</span>)
</span></span></code></pre></div><p>In the case of pandas, the result is:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>     p    a    b    c    d
</span></span><span style=display:flex><span><span style=color:#ae81ff>1.0</span>  <span style=color:#ae81ff>1</span>  <span style=color:#ae81ff>1.0</span>  <span style=color:#ae81ff>2.0</span>  <span style=color:#ae81ff>3.0</span>  <span style=color:#ae81ff>4.0</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2.0</span>  <span style=color:#ae81ff>2</span>  <span style=color:#ae81ff>3.0</span>  <span style=color:#ae81ff>4.0</span>  <span style=color:#ae81ff>5.0</span>  <span style=color:#ae81ff>6.0</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>3.0</span>  <span style=color:#ae81ff>3</span>  <span style=color:#ae81ff>5.0</span>  <span style=color:#ae81ff>6.0</span>  NaN  NaN
</span></span><span style=display:flex><span><span style=color:#ae81ff>4.0</span>  <span style=color:#ae81ff>4</span>  <span style=color:#ae81ff>7.0</span>  <span style=color:#ae81ff>8.0</span>  NaN  NaN
</span></span><span style=display:flex><span>NaN  <span style=color:#ae81ff>5</span>  NaN  NaN  <span style=color:#ae81ff>1.0</span>  <span style=color:#ae81ff>2.0</span>
</span></span><span style=display:flex><span>NaN  <span style=color:#ae81ff>6</span>  NaN  NaN  <span style=color:#ae81ff>3.0</span>  <span style=color:#ae81ff>4.0</span>
</span></span></code></pre></div><p>In the case of cuDF,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>         a     b     c     d
</span></span><span style=display:flex><span>p
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>        <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>2</span>     <span style=color:#ae81ff>3</span>     <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>        <span style=color:#ae81ff>3</span>     <span style=color:#ae81ff>4</span>     <span style=color:#ae81ff>5</span>     <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span>        <span style=color:#ae81ff>5</span>     <span style=color:#ae81ff>6</span>  <span style=color:#f92672>&lt;</span>NA<span style=color:#f92672>&gt;</span>  <span style=color:#f92672>&lt;</span>NA<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span>        <span style=color:#ae81ff>7</span>     <span style=color:#ae81ff>8</span>  <span style=color:#f92672>&lt;</span>NA<span style=color:#f92672>&gt;</span>  <span style=color:#f92672>&lt;</span>NA<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span>NA<span style=color:#f92672>&gt;</span>  <span style=color:#f92672>&lt;</span>NA<span style=color:#f92672>&gt;</span>  <span style=color:#f92672>&lt;</span>NA<span style=color:#f92672>&gt;</span>     <span style=color:#ae81ff>1</span>     <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span>NA<span style=color:#f92672>&gt;</span>  <span style=color:#f92672>&lt;</span>NA<span style=color:#f92672>&gt;</span>  <span style=color:#f92672>&lt;</span>NA<span style=color:#f92672>&gt;</span>     <span style=color:#ae81ff>3</span>     <span style=color:#ae81ff>4</span>
</span></span></code></pre></div><p>The type of the column with missing values is different, because pandas uses NaN for missing values, which causes the type of the column float64 type.
The big difference is that pandas has a column called <code>p</code>, but cuDF does not. Also, the name of the resulting index is different.</p><p>The column <code>p</code> is originally the index column of the left DataFrame, and it seems like a strange specification that this is created as a column of the resulting DataFrame (columns like <code>p</code> are only created in the case of the special parameter combination described above). In RDB joins, such columns are not created. On the other hand, the results are clearly different, so there is a possibility that this could cause a compatibility problem for user programs.</p><p>In FireDucks, we have adjusted the code so that the results are as close as possible to those of pandas even in such cases.</p><p>As described above, there are cases where the results differ between pandas and cuDF. The GPU version of FireDucks has been implemented to absorb such differences and produce results as close as possible to those of pandas. The GPU version of FireDucks is still under development and is not yet ready for use by users, but we hope that you will try it out when it is completed.</p><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/posts/cudf_vs_fireducks/ aria-label="Previous - Exploring performance benefits of FireDucks over cuDF" class="btn btn-primary"><span class=me-1>←</span>Previous</a></li><li><a class="btn btn-primary disabled">Next<span class=ms-1>→</span></a></li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="Post issues on GitHub issues" aria-label="Post issues on GitHub issues"><a target=_blank rel=noopener href=https://github.com/fireducks-dev/fireducks aria-label="Post issues on GitHub issues"><i class="fa-brands fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Send an e-mail to us" aria-label="Send an e-mail to us"><a target=_blank rel=noopener href=mailto:contact@fireducks.jp.nec.com aria-label="Send an e-mail to us"><i class="fa-solid fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Follow us in X" aria-label="Follow us in X"><a target=_blank rel=noopener href=https://x.com/fireducksdev aria-label="Follow us in X"><i class="fa-brands fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Join us on Slack" aria-label="Join us on Slack"><a target=_blank rel=noopener href=https://join.slack.com/t/fireducks/shared_invite/zt-2j4lucmtj-IGR7AWlXO62Lu605pnBJ2w aria-label="Join us on Slack"><i class="fa-brands fa-slack"></i></a></li></ul></div><div class="col-6 col-sm-4 text-end text-xs-center order-sm-3"></div><div class="td-footer__copyright-etc col-12 col-sm-4 text-center py-2 order-sm-2"><span>&copy; 2024 FireDucks Dev Team All Rights Reserved</span></div></div></div></footer></div><script src=/js/main.min.350b703200e2632331b6ab5a6c71195d176b52e89c9b70db7c43764d40b28d92.js integrity="sha256-NQtwMgDiYyMxtqtabHEZXRdrUuicm3DbfEN2TUCyjZI=" crossorigin=anonymous></script><script defer src=/js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin=anonymous></script><script src=/js/tabpane-persist.js></script></body></html>